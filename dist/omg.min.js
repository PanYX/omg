/*!
 * omg.js v3.0.0-beta.2
 * Author: PengJiyuan
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.omg=e()}(this,function(){"use strict";!function(){for(var t=["ms","moz","webkit","o"],e=0,n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),s=window.setTimeout(function(){t(n+i)},i);return e=n+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){var n=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var o=n[s];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(i[a]=o[a])}return i},writable:!0,configurable:!0})}();var t={getPos:function(t){var e=t||event,n=[e.pageX,e.pageY];return{x:n[0],y:n[1]}},bind:function(t,e,n){return window.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n,t},unbind:function(t,e,n){window.removeEventListener?t.removeEventListener(e,n,!1):window.detachEvent?t.detachEvent(e,n):t["on"+e]=""},reverse:function(t){for(var e=[t.length,[]],n=e[0],i=e[1],s=0;s<n;s++)i[s]=t[n-s-1];return i},calculateCoord:function(t,e){var n,i,s,o,a,r=[Math.abs(t),Math.abs(e)],h=r[0],c=r[1];if(s=h>=c?h:c,a=s.toString().length,1===(o=s<1?this.formatFloat(s*Math.pow(10,a-2),1):s/Math.pow(10,a-1))&&a>1)o=10,a--;else if(o>10){var l=o.toString().length;o/=Math.pow(10,l-1),a=a-l+1}var u=[[1,.2],[1.2,.2],[1.4,.2],[1.5,.3],[1.8,.3],[2,.4],[2.5,.5],[3,.5],[3.5,.5],[4,.5],[5,1],[6,1],[7,1],[8,1],[10,2]];return u.forEach(function(t,e){(0===e?0:u[e-1][0])<o&&o<=t[0]&&(n=t[1],i=t[0])}),{gap:s<1?n/Math.pow(10,a-2):n*Math.pow(10,a-1),max:s<1?i/Math.pow(10,a-2):i*Math.pow(10,a-1)}},formatFloat:function(t){var e=Math.pow(10,10);return parseInt(t*e,10)/e},getMaxMin:function(t,e,n){var i,s,o=[],a=[];return e.forEach(function(e){var i=[];e.data.forEach(function(e){t?i.push(e[0]):n.data&&n.data.length>0?i.push(e):i.push(e[1])}),o.push(Math.max.apply(null,i)),a.push(Math.min.apply(null,i))}),i=Math.max.apply(null,o),s=Math.min.apply(null,a),{max:i,min:s}},isArr:function(t){return"[object Array]"===Object.prototype.toString.call(t)}},e=function(t){this._=t,this.triggeredMouseDown=!1,this.triggeredMouseMove=!1};e.prototype.getPos=function(t){var e=t||event,n=[e.pageX-this._.element.offsetLeft,e.pageY-this._.element.offsetTop];return{x:n[0],y:n[1]}},e.prototype.triggerEvents=function(){if(this._.objects.some(function(e){return e.events&&t.isArr(e.events)||e.enableDrag})||this._.enableGlobalTranslate){var e=this._.objects.some(function(t){return t.events&&t.events.some(function(t){return"mouseenter"===t.eventType||"mousemove"===t.eventType||"drag"===t.eventType||"dragin"===t.eventType||"dragout"===t.eventType||"drop"===t.eventType})})||this._.globalMousemove;e&&!this.triggeredMouseMove&&(this.bindMouseMove(),this.triggeredMouseMove=!0),!e&&this.triggeredMouseMove&&(this.unBindMouseMove(),this.triggeredMouseMove=!1),this.triggeredMouseDown||(t.bind(this._.element,"mousedown",this.mouseDown.bind(this)),this.triggeredMouseDown=!0)}},e.prototype.bindMouseMove=function(){t.bind(this._.element,"mousemove",this.mouseEnterOrMove.bind(this))},e.prototype.unBindMouseMove=function(){t.unbind(this._.element,"mousemove",this.mouseEnterOrMove.bind(this))},e.prototype.mouseEnterOrMove=function(t){var e,n=this.getPos(t).x,i=this.getPos(t).y;this._.globalMousemove&&this._.globalMousemove(t),e=this._.objects.some(function(t){return t.isDragging});var s=this._._objects.filter(function(t){return t.isPointInner(n,i)});if(e){s&&s.length>1&&s[1].events&&s[1].events.forEach(function(t){"dragin"!==t.eventType||s[1].hasDraggedIn||(s[1].hasDraggedIn=!0,t.callback&&t.callback(s[1]))});this._._objects.some(function(t){return t.hasDraggedIn&&(!t.isPointInner(n,i)||s[1]!==t)&&function(t){t.hasDraggedIn&&t.events.forEach(function(t){"dragout"===t.eventType&&t.callback&&t.callback(s[1])}),t.hasDraggedIn=!1}(t)})}else{s&&s.length>0&&s[0].events&&s[0].events.forEach(function(t){"mouseenter"!==t.eventType||s[0].hasEnter?"mousemove"===t.eventType&&t.callback&&t.callback(s[0]):(s[0].hasEnter=!0,t.callback&&t.callback(s[0]))});this._._objects.some(function(t){return t.hasEnter&&(!t.isPointInner(n,i)||s[0]!==t)&&function(t){t.hasEnter&&t.events.forEach(function(e){"mouseleave"===e.eventType&&e.callback&&e.callback(t)}),t.hasEnter=!1}(t)})}},e.prototype.mouseDown=function(e){var n,i,s,o,a,r=this;this._.globalMousedown&&this._.globalMousedown(e);var h=this._.objects.some(function(t){return t.enableDrag}),c=this.getPos(e).x,l=this.getPos(e).y;r.cacheX=c,r.cacheY=l;var u=this._._objects.filter(function(t){return t.isPointInner(c,l)&&!t.isBg});if(u&&u.length>0&&(u[0].enableChangeIndex&&r.changeOrder(u[0]),u[0].events&&u[0].events.some(function(t){return"mousedown"===t.eventType&&t.callback&&t.callback(u[0])})),h){n=r._._objects.filter(function(t){return t.isPointInner(c,l)&&!t.isBg}),i=n.length>0&&n[0].events&&n[0].events.some(function(t){return"drag"===t.eventType&&(o=t.callback),"drag"===t.eventType}),s=n.length>0&&n[0].events&&n[0].events.some(function(t){return"dragend"===t.eventType&&(a=t.callback),"dragend"===t.eventType});var f=function(t){var e=r.getPos(t).x,s=r.getPos(t).y;n[0].moveX=n[0].moveX+e-r.cacheX,n[0].moveY=n[0].moveY+s-r.cacheY,i&&o(u[0]),r._.redraw(),r.cacheX=e,r.cacheY=s,n[0].isDragging=!0},d=function(e){var i=r.getPos(e).x,o=r.getPos(e).y,h=r._._objects.filter(function(t){return t.isPointInner(i,o)});if(h&&h.length>1&&h[1].hasDraggedIn){h[1].hasDraggedIn=!1;!h[1].events.some(function(t){return"drop"===t.eventType&&t.callback&&t.callback(h[1],h[0])})&&h[1].events.some(function(t){return"dragout"===t.eventType&&t.callback&&t.callback(h[1])})}s&&a(u[0]),t.unbind(document,"mousemove",f),t.unbind(document,"mouseup",d),n[0].isDragging=!1};n&&n.length>0&&n[0].enableDrag&&(t.bind(document,"mousemove",f),t.bind(document,"mouseup",d))}if(this._.enableGlobalTranslate&&!(n&&n.length>0)){var g=function(t){var e=r.getPos(t).x,n=r.getPos(t).y;r._.transX=r._.transX+e-r.cacheX,r._.transY=r._.transY+n-r.cacheY,r._.redraw(),r.cacheX=e,r.cacheY=n},v=function(){t.unbind(document,"mousemove",g),t.unbind(document,"mouseup",v)};t.bind(document,"mousemove",g),t.bind(document,"mouseup",v)}},e.prototype.changeOrder=function(e){var n=this._.objects.indexOf(e),i=this._.objects[n];this._.objects.splice(n,1),this._.objects.push(i),this._._objects=t.reverse(this._.objects),this._.redraw()};var n=function(){};n.prototype.hexToRGB=function(t){var e=[];return 3===(t=t.substr(1)).length&&(t=t.replace(/(.)/g,"$1$1")),t.replace(/../g,function(t){e.push(parseInt(t,16))}),{r:e[0],g:e[1],b:e[2],rgb:"rgb("+e.join(",")+")"}},n.prototype.rgbToHSL=function(t,e,n){t/=255,e/=255,n/=255;var i,s,o=Math.max(t,e,n),a=Math.min(t,e,n),r=(o+a)/2;if(o==a)i=s=0;else{var h=o-a;switch(s=r>.5?h/(2-o-a):h/(o+a),o){case t:i=(e-n)/h+(e<n?6:0);break;case e:i=(n-t)/h+2;break;case n:i=(t-e)/h+4}i/=6}return{h:i,s:s,l:r,hsl:"hsl("+360*i+", "+100*s+"%, "+100*r+"%)"}},n.prototype.hslToRGB=function(){},n.prototype.lighten=function(t,e){var n,i,s,o,a,r;if(t&&e&&/^[0-9]{1,2}%$/.test(e))return this.isRgba(t)?(a=this.getRgba(t),r=+a.a-+e.slice(0,-1)/100,"rgba("+a.r+", "+a.g+", "+a.b+", "+r+")"):(n=this.getHsl(t),i=+n.h,s=+n.s,o=100*+n.l+ +e.slice(0,-1),"hsl("+360*i+", "+100*s+"%, "+o+"%)")},n.prototype.darken=function(t,e){var n,i,s,o,a,r;if(t&&e&&/^[0-9]{1,2}%$/.test(e))return this.isRgba(t)?(a=this.getRgba(t),r=+a.a+ +e.slice(0,-1)/100,"rgba("+a.r+", "+a.g+", "+a.b+", "+r+")"):(n=this.getHsl(t),i=+n.h,s=+n.s,o=100*+n.l-+e.slice(0,-1),"hsl("+360*i+", "+100*s+"%, "+o+"%)")},n.prototype.isHex=function(t){return/^#[a-fA-F0-9]{3}$|#[a-fA-F0-9]{6}$/.test(t)},n.prototype.isRgb=function(t){return/^rgb\((\s*[0-5]{0,3}\s*,?){3}\)$/.test(t)},n.prototype.isRgba=function(t){return/^rgba\((\s*[0-5]{0,3}\s*,?){3}[0-9.\s]*\)$/.test(t)},n.prototype.getRgb=function(t){var e,n,i,s;if(this.isHex(t)){var o;n=(o=[(e=this.hexToRGB(t)).r,e.g,e.b])[0],i=o[1],s=o[2]}else if(this.isRgb(t)){var a;n=(a=[(e=t.slice(4,-1).split(","))[0],e[1],e[2]])[0],i=a[1],s=a[2]}return{r:n,g:i,b:s}},n.prototype.getRgba=function(t){var e,n,i,s,o,a;return a=[(e=t.slice(5,-1).split(","))[0],e[1],e[2],e[3]],n=a[0],i=a[1],s=a[2],o=a[3],{r:n,g:i,b:s,a:o}},n.prototype.getHsl=function(t){var e,n,i,s,o,a,r,h,c;i=(c=[(n=this.getRgb(t)).r,n.g,n.b])[0],s=c[1],o=c[2];var l;return l=[(e=this.rgbToHSL(i,s,o)).h,e.s,e.l],a=l[0],r=l[1],h=l[2],{h:a,s:r,l:h}};var i=function(){this.imageList=[],this.loadNum=0};i.prototype.ready=function(t){var e=this;this.imageList.forEach(function(t){e.loadImg(t)});var n=setInterval(function(){e.loadNum===e.imageList.length&&(clearInterval(n),t&&t())},50)},i.prototype.loadImg=function(t){var e=this,n=setInterval(function(){!0===t.complete&&(e.loadNum++,clearInterval(n))},50)},i.prototype.addImg=function(t){var e=this;t.forEach(function(t){var n=new Image;n.src=t,n.name=t,n.loaded=!1,e.imageList.push(n)})},i.prototype.getImg=function(t){var e;return this.imageList.forEach(function(n){n.name==t&&(e=n)}),e};var s=function(t){return function(e){return Math.pow(e,t)}},o=function(t){return function(e){return 1-Math.abs(Math.pow(e-1,t))}},a=function(t){return function(e){return e<.5?s(t)(2*e)/2:o(t)(2*e-1)/2+.5}},r=s(2),h=o(2),c=a(2),l=s(3),u=o(3),f=a(3),d=s(4),g=o(4),v=a(4),p=s(5),m=o(5),b=a(5),y=function(t){var e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?(t-=1.5/n,e*t*t+.75):t<2.5/n?(t-=2.25/n,e*t*t+.9375):(t-=2.625/n,e*t*t+.984375)},x=function(t){return 1-y(1-t)},w=Object.freeze({linear:function(t){return t},quadIn:r,quadOut:h,quadInOut:c,cubicIn:l,cubicOut:u,cubicInOut:f,quartIn:d,quartOut:g,quartInOut:v,quintIn:p,quintOut:m,quintInOut:b,sineIn:function(t){return 1+Math.sin(Math.PI/2*t-Math.PI/2)},sineOut:function(t){return Math.sin(Math.PI/2*t)},sineInOut:function(t){return(1+Math.sin(Math.PI*t-Math.PI/2))/2},bounceOut:y,bounceIn:x,bounceInOut:function(t){return t<.5?.5*x(2*t):.5*y(2*t-1)+.5}}),T=function(t){var e=t.from,n=t.to,i=t.duration,s=t.delay,o=t.easing,a=t.onStart,r=t.onUpdate,h=t.onFinish;for(var c in e)void 0===n[c]&&(n[c]=e[c]);for(var l in n)void 0===e[l]&&(e[l]=n[l]);this.from=e,this.to=n,this.duration=i||500,this.delay=s||0,this.easing=o||"linear",this.onStart=a,this.onUpdate=r,this.onFinish=h,this.startTime=Date.now()+this.delay,this.started=!1,this.finished=!1,this.keys={}};T.prototype.update=function(){if(this.time=Date.now(),!(this.time<this.startTime))if(this.elapsed!==this.duration){this.elapsed=this.time-this.startTime,this.elapsed=this.elapsed>this.duration?this.duration:this.elapsed;for(var t in this.to)this.keys[t]=this.from[t]+(this.to[t]-this.from[t])*w[this.easing](this.elapsed/this.duration);this.started||(this.onStart&&this.onStart(this.keys),this.started=!0),this.onUpdate(this.keys)}else this.finished||(this.finished=!0,this.onFinish&&this.onFinish(this.keys))};var M=function(t,e){this._=e,this.commonData={color:t.color,x:t.x,y:t.y,width:t.width,height:t.height,moveX:0,moveY:0,zindex:0}};M.prototype.on=function(t,e){var n=this;if(!this.isBg){if(!t)throw"no eventTypes defined!";if(!e||"function"!=typeof e)throw"you need defined a callback!";this.events=this.events||[];var i=this;return t.split(" ").forEach(function(t){~n._.eventTypes.indexOf(t)?i.events.push({eventType:t,callback:e}):console.error(t+" is not in eventTypes!")}),this}},M.prototype.isPointInner=function(t,e){return function(t,e){var n=this.moveX,i=this.moveY,s=this.fixed?0:this._.transX,o=this.fixed?0:this._.transY,a=t>this.x+n+s,r=t<this.x+this.width+n+s,h=e>this.y+i+o,c=e<this.y+this.height+i+o;switch(this.type){case"rectangle":return!!(a&&r&&h&&c);case"arc":var l,u,f=this.x,d=this.y,g=Math.PI,v=this.startAngle<0?2*g+g/180*this.startAngle:g/180*this.startAngle,p=this.endAngle<0?2*g+g/180*this.endAngle:g/180*this.endAngle,m=this.radius,b=t-f-n-s,y=e-d-i-o;if(isNaN(v)||isNaN(p))l=!!(Math.sqrt(b*b+y*y)<=m);else{var x;b>=0&&y>=0?x=0===b?g/2:Math.atan(y/b):b<=0&&y>=0?x=0===b?g:g-Math.atan(y/Math.abs(b)):b<=0&&y<=0?x=0===b?g:Math.atan(Math.abs(y)/Math.abs(b))+g:b>=0&&y<=0&&(x=0===b?3*g/2:2*g-Math.atan(Math.abs(y)/b)),u=Math.sqrt(b*b+y*y),l=v<p?!!(x>=v&&x<=p&&u<=m):!!((x>=0&&x<=p||x>=v&&x<=2*g)&&u<=m)}return l;case"polygon":for(var w=this.matrix,T=t-n-s,M=e-i-o,I=!1,j=0,k=w.length-1;j<w.length;k=j++)w[j][1]>M!=w[k][1]>M&&T<(w[k][0]-w[j][0])*(M-w[j][1])/(w[k][1]-w[j][1])+w[j][0]&&(I=!I);return I}}.bind(this)(t,e)},M.prototype.config=function(t){if("[object Object]"===Object.prototype.toString.call(t))return t.drag&&(this.enableDrag=t.drag),t.changeIndex&&(this.enableChangeIndex=t.changeIndex),t.fixed&&(this.fixed=t.fixed),t.bg&&(this.isBg=t.bg),this.zindex=t.zindex||0,this},M.prototype.animateTo=function(t,e){var n=this;void 0===e&&(e={});var i={},s=t,o={};for(var a in s)o[a]=n[a];i.from=o,i.to=s,i.onUpdate=function(t){e.onUpdate&&e.onUpdate(t);for(var i in s)n[i]=t[i]};for(var r in e)"onUpdate"!==r&&(i[r]=e[r]);var h=new T(i);return this._.animationList.push(h),this._.tick(),this},M.prototype.drag=function(t){this.enableDrag=t},M.prototype.changeIndex=function(t){this.enableChangeIndex=t};var I=function(t,e){var n=new M(t,e);return Object.assign({},n.commonData,{isDragging:!1,hasEnter:!1,hasDraggedIn:!1,on:n.on,animateTo:n.animateTo,isPointInner:n.isPointInner,config:n.config,drag:n.drag,changeIndex:n.changeIndex,_:n._})},j={arc:function(t,e){return Object.assign({},I(t,e),{type:"arc",draw:function(){var n=e.canvas,i=this.x=t.x,s=this.y=t.y,o=this.style=t.style,a=this.startAngle=t.startAngle,r=this.endAngle=t.endAngle;n.save(),this.fixed&&n.translate(-e.transX,-e.transY),n.translate(this.moveX,this.moveY),n.translate(i,s),n.beginPath(),isNaN(a)||isNaN(r)?n.arc(0,0,this.radius,0,2*Math.PI):(n.arc(0,0,this.radius,Math.PI/180*a,Math.PI/180*r,!1),n.save(),n.rotate(Math.PI/180*r),n.moveTo(this.radius,0),n.lineTo(0,0),n.restore(),n.rotate(Math.PI/180*a),n.lineTo(this.radius,0)),"fill"===o?(n.fillStyle=this.color,n.fill()):(n.strokeStyle=this.color,n.stroke()),n.closePath(),n.restore()},radius:t.radius})},coord:function(e,n){var i,s,o,a,r,h,c,l,u,f,d,g=n.canvas,v=this.x=e.x,p=this.y=e.y,m=e.width,b=e.height,y=e.xAxis,x=e.series,w=e.boundaryGap,T=e.title,M=e.subTitle,j=m<=300?m/5:m/10,k=t.getMaxMin(!1,x,y).max,_=t.getMaxMin(!1,x,y).min,P=t.calculateCoord(k,_).gap;h=b-2*j,u=k>0?Math.ceil(k/P):0,f=_<0?Math.ceil(Math.abs(_)/P):0,s=u+f,l=Math.round(h/s),a=s,d=l,y.data&&y.data.length>0&&(i=y.data.length,c=(r=m-2*j)/(o=w?i:i-1));return Object.assign({},I(e,n),{type:"rectangle",draw:function(){g.save(),g.translate(this.moveX,this.moveY),this.fixed&&g.translate(-n.transX,-n.transY),this.backgroundColor&&(g.save(),g.fillStyle=this.backgroundColor,g.fillRect(v,p,m,b),g.restore()),g.save(),g.font=m<=300?"18px serif":"24px serif",g.textAlign="left",g.textBaseline="top",g.fillText(T,j/2,10),g.restore(),g.save(),g.fillStyle="#666666",g.font=m<=300?"10px serif":"14px serif",g.textAlign="left",g.textBaseline="top",g.fillText(M,j/2+4,40),g.restore(),g.translate(v+j,p+j+u*l+20),g.beginPath(),g.moveTo(0,0+f*l),g.lineTo(0,f*l-(b-2*j)-5),g.stroke(),g.closePath();for(var e=0;e<=u;e++)g.beginPath(),g.moveTo(0,-l*e),g.lineTo(-5,-l*e),g.stroke(),g.closePath(),g.save(),g.strokeStyle="#ccc",g.beginPath(),g.moveTo(0,-l*e),g.lineTo(m-2*j,-l*e),g.stroke(),g.restore(),g.closePath(),g.save(),g.font="12px serif",g.textAlign="right",g.textBaseline="middle",g.fillText(t.formatFloat(P*e),-10,-l*e),g.restore();for(var i=0;i<=f;i++)g.beginPath(),g.moveTo(0,l*i),g.lineTo(-5,l*i),g.stroke(),g.closePath(),g.save(),g.strokeStyle="#ccc",g.beginPath(),g.moveTo(0,l*i),g.lineTo(m-2*j,l*i),g.stroke(),g.restore(),g.closePath(),g.save(),g.font="12px serif",g.textAlign="right",g.textBaseline="middle",0!==i&&g.fillText(t.formatFloat(-P*i),-10,l*i),g.restore();g.beginPath(),g.moveTo(0,0),g.lineTo(m-2*j,0),g.stroke(),g.closePath(),y.data&&y.data.length>0&&y.data.forEach(function(t,e){g.beginPath(),g.moveTo(c*(e+1),0),g.lineTo(c*(e+1),5),g.save(),g.font="15px serif",g.textAlign="center",g.textBaseline="top",w?g.fillText(t,c*e+c/2,5+f*d):g.fillText(t,c*e,5+f*d),g.restore(),g.stroke(),g.closePath()}),g.restore()},xLength:r,yLength:h,xSpace:o,ySpace:a,xGapLength:c,yGapLength:l,upCount:u,downCount:f,gap:P,margin:j,TO_TOP:20,boundaryGap:w,backgroundColor:e.backgroundColor||"#F3F3F3"})},image:function(t,e){t.src&&!~e.images.indexOf(t.src)&&e.images.push(t.src);return Object.assign({},I(t,e),{type:"rectangle",draw:function(){var n=e.canvas,i=this.x=t.x,s=this.y=t.y,o=t.src;n.save(),n.translate(this.moveX,this.moveY),this.fixed&&n.translate(-e.transX,-e.transY),this.sliceWidth&&this.sliceHeight?n.drawImage(e.loader.getImg(o),this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight,i,s,this.width,this.height):n.drawImage(e.loader.getImg(o),i,s,this.width,this.height),n.restore()},sliceWidth:t.sliceWidth,sliceHeight:t.sliceHeight,sliceX:t.sliceX,sliceY:t.sliceY})},line:function(t,e){var n=e.canvas,i=t.matrix,s=t.lineWidth,o=t.lineCap,a=t.lineJoin,r=t.strokeColor,h=t.smooth;return Object.assign({},I(t,e),{type:"line",draw:function(){if(n.save(),n.translate(this.moveX,this.moveY),this.fixed&&n.translate(-e.transX,-e.transY),n.lineWidth=s,n.strokeStyle=r,n.beginPath(),n.lineDashOffset=this.offset,this.dash&&"[object Array]"===Object.prototype.toString.call(this.dash)&&n.setLineDash(this.dash),o&&(n.lineCap=o),a&&(n.lineJoin=a),h)for(var t=0;t<i.length;t++)if(0===t)n.moveTo(i[t][0],i[t][1]);else{var c=function(t,e,n,i){var s,o,a,r;if(n&&i||(n=.25,i=.25),e<1?(s=t[0][0]+(t[1][0]-t[0][0])*n,o=t[0][1]+(t[1][1]-t[0][1])*n):(s=t[e][0]+(t[e+1][0]-t[e-1][0])*n,o=t[e][1]+(t[e+1][1]-t[e-1][1])*n),e>t.length-3){var h=t.length-1;a=t[h][0]-(t[h][0]-t[h-1][0])*i,r=t[h][1]-(t[h][1]-t[h-1][1])*i}else a=t[e+1][0]-(t[e+2][0]-t[e][0])*i,r=t[e+1][1]-(t[e+2][1]-t[e][1])*i;return{pA:{x:s,y:o},pB:{x:a,y:r}}}(i,t-1);n.bezierCurveTo(c.pA.x,c.pA.y,c.pB.x,c.pB.y,i[t].x,i[t].y)}else i.forEach(function(t,e){0===e?n.moveTo(t[0],t[1]):n.lineTo(t[0],t[1])});n.stroke(),n.closePath(),n.restore()},totalLength:void 0,dash:t.dash,offset:t.offset||0})},rectangle:function(t,e){return Object.assign({},I(t,e),{type:"rectangle",draw:function(){var t=e.canvas;t.save(),t.translate(this.moveX,this.moveY),this.fixed&&t.translate(-e.transX,-e.transY),t.fillStyle=this.color?this.color:"#000",t.fillRect(this.x,this.y,this.width,this.height),t.restore()}})},text:function(t,e){return Object.assign({},I(t,e),{type:"rectangle",draw:function(){var n,i,s=e.canvas,o=this.x=t.x,a=this.y=t.y,r=t.width,h=t.height,c=t.paddingTop?t.paddingTop:0,l=t.center,u=t.font,f=t.type,d=t.color,g=this.text;f&&(s.save(),s.translate(this.moveX,this.moveY),this.fixed&&s.translate(-e.transX,-e.transY),this.backgroundColor&&(s.save(),s.fillStyle=this.backgroundColor,s.fillRect(o,a,r,h),s.restore()),s.font=u,s.textBaseline="top",n=s.measureText(g).width,i=function(t,e,n){var i=t.measureText(e).width,s=t.measureText("...").width;if(i<=n||i<=s)return e;for(var o=e.length;i>=n-s&&o-- >0;)e=e.substring(0,o),i=t.measureText(e).width;return e+"..."}(s,g,r-8),"stroke"===f?(s.strokeStyle=d,l?n<r-8&&s.strokeText(i,o+4+(r-n-8)/2,a+c):s.strokeText(i,o+4,a+c)):(s.fillStyle=d,l?n<r-8&&s.fillText(i,o+4+(r-n-8)/2,a+c):s.fillText(i,o+4,a+c)),s.restore())},backgroundColor:t.backgroundColor,text:t.text})},polygon:function(t,e){var n=e.canvas,i=t.lineWidth||1,s=t.type||"fill";return Object.assign({},I(t,e),{type:"polygon",draw:function(){n.save(),n.translate(this.moveX,this.moveY),this.fixed&&n.translate(-e.transX,-e.transY),n.beginPath(),this.matrix.forEach(function(t,e){0===e?n.moveTo(t[0],t[1]):n.lineTo(t[0],t[1])}),n.lineTo(this.matrix[0][0],this.matrix[0][1]),"fill"===s?(n.fillStyle=this.color,n.fill()):(n.strokeStyle=this.color,n.lineWidth=i,n.stroke()),n.closePath(),n.restore()},matrix:t.matrix})}},k=function(i){var s=this;this.version="3.0.0-beta.2",this.objects=[],this.transX=0,this.transY=0,this.scale=1,this.loader=null,this.pointerInnerArray=[],this.globalMousedown=void 0,this.globalMousemove=void 0,this.isDragging=!1,this.Tween=T,this.animationList=[],this.animationId=null,this.animating=!1,this.eventTypes=["mousedown","mouseup","mouseenter","mouseleave","mousemove","drag","dragend","dragin","dragout","drop"],this._event=new e(this),this.color=new n,this.element=i.element,this.canvas=this.element.getContext("2d"),this.width=i.width,this.height=i.height,function(t,e){var n=window.devicePixelRatio||1,i=null;t.forEach(function(t){i=t.getContext("2d"),t.style.width=e.width+"px",t.style.height=e.height+"px",t.width=e.width*n,t.height=e.height*n,i.scale(n,n)})}([this.element],{width:this.width,height:this.height}),this.enableGlobalTranslate=i.enableGlobalTranslate||!1,this.images=i.images||[],this.utils=t,Object.keys(j).forEach(function(t){s[t]=function(e){return j[t](e,this)}})};k.prototype.imgReady=function(){this.loader=new i,this.loader.addImg(this.images)},k.prototype.addChild=function(e){t.isArr(e)?this.objects=this.objects.concat(e):this.objects.push(e),this.objects.sort(function(t,e){return t.zindex-e.zindex}),this._objects=t.reverse(this.objects)},k.prototype.removeChild=function(e){t.isArr(e)?this.objects=this.objects.filter(function(t){return!~e.indexOf(t)}):this.objects=this.objects.filter(function(t){return t!==e}),this._objects=t.reverse(this.objects)},k.prototype.removeFirstChild=function(){this.objects.pop(),this._objects=t.reverse(this.objects)},k.prototype.removeLastChild=function(){this.objects.shift(),this._objects=t.reverse(this.objects)},k.prototype.removeAllChilds=function(){this.objects=[],this._objects=[]},k.prototype.show=function(){var t=this;this.imgReady(),this.loader.ready(function(){t.draw(),t._event.triggerEvents()})},k.prototype.draw=function(){this.objects.forEach(function(t){t.draw()})},k.prototype.redraw=function(){this.clear(),this.canvas.save(),this.canvas.translate(this.transX,this.transY),this.draw(),this.canvas.restore()},k.prototype.clear=function(){this.canvas.clearRect(0,0,this.width,this.height)},k.prototype.tick=function(){var t=this,e=function(){t.animationList.forEach(function(e,n){e.finished?t.animationList.splice(n--,1):e.update()}),t.redraw(),t[t.animationId]=requestAnimationFrame(e)};return this.animationList.length>0&&!this.animating?(this.animating=!0,this.animationId=Date.now(),e()):0===this.animationList.length&&this.animating&&(this.animating=!1,cancelAnimationFrame(this.animationId)),this.animationId},k.prototype.clearAnimation=function(){this.animationList=[],this.tick()},k.prototype.animate=function(t){this._event.triggerEvents();var e=Date.now();return this.animationList.push(t),this.tick(),e},k.prototype.stop=function(t){cancelAnimationFrame(this[t])},k.prototype.globalTranslate=function(t){"boolean"==typeof t&&t&&(this.enableGlobalTranslate=!0)},k.prototype.getVersion=function(){return this.version},k.prototype.scaleCanvas=function(e){if("boolean"==typeof e&&e){var n=this;t.bind(this.element,"wheel",function(t){t.deltaY<0?n.scale<=3&&(n.scale+=.02,n.redraw()):n.scale>.5&&(n.scale-=.02,n.redraw())})}},k.prototype.mousedown=function(t){this.globalMousedown=t},k.prototype.mousemove=function(t){this.globalMousemove=t};return function(t){return new k(t)}});
