/*!
 * omg.js v3.1.1
 * Author: PengJiyuan
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.omg=e()}(this,function(){"use strict";!function(){for(var t=["ms","moz","webkit","o"],s=0,e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-s)),n=window.setTimeout(function(){t(e+i)},i);return s=e+i,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){var i=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),s=1;s<arguments.length;s++){var a=i[s];if(null!=a)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},writable:!0,configurable:!0})}();var p={getPos:function(t){var e=t||event,i=[e.offsetX,e.offsetY];return{x:i[0],y:i[1]}},bind:function(t,e,i){return window.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i,t},unbind:function(t,e,i){window.removeEventListener?t.removeEventListener(e,i,!1):window.detachEvent?t.detachEvent(e,i):t["on"+e]=""},reverse:function(t){for(var e=[t.length,[]],i=e[0],n=e[1],s=0;s<i;s++)n[s]=t[i-s-1];return n},formatFloat:function(t){var e=Math.pow(10,10);return parseInt(t*e,10)/e},getMax:function(t){return Math.max.apply(null,t)},getMin:function(t){return Math.min.apply(null,t)},insertArray:function(t,e,i,n){var s=[e,i].concat(n);Array.prototype.splice.apply(t,s)},isArr:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isObj:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},e=function(t){this._=t,this.triggeredMouseDown=!1,this.triggeredMouseMove=!1};e.prototype.getPos=function(t){var e=t||event,i=[e.offsetX,e.offsetY];return{x:i[0],y:i[1]}},e.prototype.triggerEvents=function(){if(this._.objects.filter(function(t){return!t.hide}).some(function(t){return t.events&&p.isArr(t.events)||t.enableDrag})||this._.enableGlobalTranslate||this._.enableGlobalScale){var t=this._.objects.some(function(t){return t.events&&t.events.some(function(t){return"mouseenter"===t.eventType||"mousemove"===t.eventType||"drag"===t.eventType||"dragin"===t.eventType||"dragout"===t.eventType||"drop"===t.eventType})})||this._.globalMousemove;t&&!this.triggeredMouseMove&&(this.bindMouseMove(),this.triggeredMouseMove=!0),!t&&this.triggeredMouseMove&&(this.unBindMouseMove(),this.triggeredMouseMove=!1),this.triggeredMouseDown||(p.bind(this._.element,"mousedown",this.mouseDown.bind(this)),this.triggeredMouseDown=!0),this._.enableGlobalScale?this.bindMouseWheel():this.unBindMouseWheel()}},e.prototype.bindMouseWheel=function(){p.bind(this._.element,"wheel",this.mouseWheel.bind(this))},e.prototype.unBindMouseWheel=function(){p.unbind(this._.element,"wheel",this.mouseWheel.bind(this))},e.prototype.mouseWheel=function(t){t.deltaY&&0<t.deltaY?this._.scale=this._.scale-.01>=this._.minDeviceScale?this._.scale-.01:this._.minDeviceScale:t.deltaY&&t.deltaY<0&&(this._.scale=this._.scale+.01<=this._.maxDeviceScale?this._.scale+.01:this._.maxDeviceScale),this._.redraw()},e.prototype.bindMouseMove=function(){p.bind(this._.element,"mousemove",this.mouseEnterOrMove.bind(this))},e.prototype.unBindMouseMove=function(){p.unbind(this._.element,"mousemove",this.mouseEnterOrMove.bind(this))},e.prototype.mouseEnterOrMove=function(t){var e,i=this,n=i.getPos(t).x,s=i.getPos(t).y;i._.globalMousemove&&i._.globalMousemove(t),e=i._.objects.some(function(t){return t.isDragging});var a=i._._objects.filter(function(t){return t.isPointInner(n,s)&&!t.hide});if(e){a&&1<a.length&&a[1].events&&a[1].events.forEach(function(t){"dragin"!==t.eventType||a[1].hasDraggedIn||(a[1].hasDraggedIn=!0,t.callback&&t.callback(a[1]))});i._._objects.some(function(t){return t.hasDraggedIn&&(!t.isPointInner(n,s)||a[1]!==t)&&((e=t).hasDraggedIn&&e.events.forEach(function(t){"dragout"===t.eventType&&t.callback&&t.callback(a[1])}),void(e.hasDraggedIn=!1));var e})}else{i._._objects.some(function(t){return t.hasEnter&&(!t.isPointInner(n,s)||a[0]!==t)&&((e=t).hasEnter&&e.events.forEach(function(t){"mouseleave"===t.eventType&&t.callback&&t.callback(e)}),void(e.hasEnter=!1));var e}),a&&0<a.length&&a[0].events&&a[0].events.forEach(function(t){"mouseenter"!==t.eventType||a[0].hasEnter?"mousemove"===t.eventType&&t.callback&&t.callback(a[0]):(a[0].hasEnter=!0,t.callback&&t.callback(a[0]))})}},e.prototype.mouseDown=function(t){var s,n,a,o,r,h=this;this._.globalMousedown&&this._.globalMousedown(t);var e=this._.objects.filter(function(t){return!t.hide}).some(function(t){return t.enableDrag}),i=this.getPos(t).x,c=this.getPos(t).y;h.cacheX=i,h.cacheY=c;var l=this._._objects.filter(function(t){return t.isPointInner(i,c)&&!t.isBg&&!t.hide});if(l&&0<l.length&&(l[0].enableChangeIndex&&h.changeOrder(l[0]),l[0].events&&l[0].events.some(function(t){return"mousedown"===t.eventType&&t.callback&&t.callback(l[0])})),e){s=h._._objects.filter(function(t){return!t.hide}).filter(function(t){return t.isPointInner(i,c)&&!t.isBg}),n=0<s.length&&s[0].events&&s[0].events.some(function(t){return"drag"===t.eventType&&(o=t.callback),"drag"===t.eventType}),a=0<s.length&&s[0].events&&s[0].events.some(function(t){return"dragend"===t.eventType&&(r=t.callback),"dragend"===t.eventType});var d=function(t){var e=h.getPos(t).x,i=h.getPos(t).y;s[0].moveX=s[0].moveX+e-h.cacheX,s[0].moveY=s[0].moveY+i-h.cacheY,n&&o(l[0]),h._.redraw(),h.cacheX=e,h.cacheY=i,s[0].isDragging=!0},u=function(t){var e=h.getPos(t).x,i=h.getPos(t).y,n=h._._objects.filter(function(t){return t.isPointInner(e,i)});n&&1<n.length&&(n[1].hasDraggedIn&&(n[1].hasDraggedIn=!1,!n[1].events.some(function(t){return"drop"===t.eventType&&t.callback&&t.callback(n[1],n[0])})&&n[1].events.some(function(t){return"dragout"===t.eventType&&t.callback&&t.callback(n[1])})));a&&r(l[0]),p.unbind(document,"mousemove",d),p.unbind(document,"mouseup",u),s[0].isDragging=!1};s&&0<s.length&&s[0].enableDrag&&(p.bind(document,"mousemove",d),p.bind(document,"mouseup",u))}if(this._.enableGlobalTranslate&&!(s&&0<s.length)){var f=function(t){var e=h.getPos(t).x,i=h.getPos(t).y;h._.transX=h._.transX+e-h.cacheX,h._.transY=h._.transY+i-h.cacheY,h._.redraw(),h.cacheX=e,h.cacheY=i},g=function(){p.unbind(document,"mousemove",f),p.unbind(document,"mouseup",g)};p.bind(document,"mousemove",f),p.bind(document,"mouseup",g)}},e.prototype.changeOrder=function(t){var e=this._.objects.indexOf(t),i=this._.objects[e];this._.objects.splice(e,1),this._.objects.push(i),this._._objects=p.reverse(this._.objects),this._.redraw()};var i=function(){};i.prototype.hexToRGB=function(t){var e=[];return 3===(t=t.substr(1)).length&&(t=t.replace(/(.)/g,"$1$1")),t.replace(/../g,function(t){e.push(parseInt(t,16))}),{r:e[0],g:e[1],b:e[2],rgb:"rgb("+e.join(",")+")"}},i.prototype.rgbToHSL=function(t,e,i){t/=255,e/=255,i/=255;var n,s,a=Math.max(t,e,i),o=Math.min(t,e,i),r=(a+o)/2;if(a==o)n=s=0;else{var h=a-o;switch(s=.5<r?h/(2-a-o):h/(a+o),a){case t:n=(e-i)/h+(e<i?6:0);break;case e:n=(i-t)/h+2;break;case i:n=(t-e)/h+4}n/=6}return{h:n,s:s,l:r,hsl:"hsl("+360*n+", "+100*s+"%, "+100*r+"%)"}},i.prototype.hslToRGB=function(){},i.prototype.lighten=function(t,e){var i,n,s;if(t&&e&&/^[0-9]{1,2}%$/.test(e))return this.isRgba(t)?(s=+(n=this.getRgba(t)).a-+e.slice(0,-1)/100,"rgba("+n.r+", "+n.g+", "+n.b+", "+s+")"):"hsl("+360*+(i=this.getHsl(t)).h+", "+100*+i.s+"%, "+(100*+i.l+ +e.slice(0,-1))+"%)"},i.prototype.darken=function(t,e){var i,n,s;if(t&&e&&/^[0-9]{1,2}%$/.test(e))return this.isRgba(t)?(s=+(n=this.getRgba(t)).a+ +e.slice(0,-1)/100,"rgba("+n.r+", "+n.g+", "+n.b+", "+s+")"):"hsl("+360*+(i=this.getHsl(t)).h+", "+100*+i.s+"%, "+(100*+i.l-+e.slice(0,-1))+"%)"},i.prototype.isHex=function(t){return/^#[a-fA-F0-9]{3}$|#[a-fA-F0-9]{6}$/.test(t)},i.prototype.isRgb=function(t){return/^rgb\((\s*[0-5]{0,3}\s*,?){3}\)$/.test(t)},i.prototype.isRgba=function(t){return/^rgba\((\s*[0-5]{0,3}\s*,?){3}[0-9.\s]*\)$/.test(t)},i.prototype.getRgb=function(t){var e,i,n,s,a,o;return this.isHex(t)?(s=(e=[(n=this.hexToRGB(t)).r,n.g,n.b])[0],a=e[1],o=e[2]):this.isRgb(t)&&(s=(i=[(n=t.slice(4,-1).split(","))[0],n[1],n[2]])[0],a=i[1],o=i[2]),{r:s,g:a,b:o}},i.prototype.getRgba=function(t){var e,i;return{r:(e=[(i=t.slice(5,-1).split(","))[0],i[1],i[2],i[3]])[0],g:e[1],b:e[2],a:e[3]}},i.prototype.getHsl=function(t){var e,i,n,s,a,o,r;return a=(e=[(s=this.getRgb(t)).r,s.g,s.b])[0],o=e[1],r=e[2],{h:(i=[(n=this.rgbToHSL(a,o,r)).h,n.s,n.l])[0],s:i[1],l:i[2]}};var t=function(){this.imageList=[],this.loadNum=0};t.prototype.ready=function(t){var e=this;this.imageList.forEach(function(t){e.loadImg(t)});var i=setInterval(function(){e.loadNum===e.imageList.length&&(clearInterval(i),t&&t())},50)},t.prototype.loadImg=function(t){var e=this,i=setInterval(function(){!0===t.complete&&(e.loadNum++,clearInterval(i))},50)},t.prototype.addImg=function(t){var i=this;t.forEach(function(t){var e=new Image;e.src=t,e.name=t,e.loaded=!1,i.imageList.push(e)})},t.prototype.getImg=function(e){var i;return this.imageList.forEach(function(t){t.name==e&&(i=t)}),i};var n=function(t,e){var i=window.devicePixelRatio||1,n=null;return t.forEach(function(t){n=t.getContext("2d"),t.style.position=e.position,t.style.width=e.width+"px",t.style.height=e.height+"px",t.width=e.width*i,t.height=e.height*i,n.scale(i,i)}),t},_=function(t,e,i,n,s,a,o){if(0===s)return!1;var r=s,h=0;if(e+r<o&&n+r<o||o<e-r&&o<n-r||t+r<a&&i+r<a||a<t-r&&a<i-r)return!1;if(t===i)return Math.abs(a-t)<=r/2;var c=(h=(e-n)/(t-i))*a-o+(t*n-i*e)/(t-i);return c*c/(h*h+1)<=r/2*r/2},s=function(t,e){var i,n,s,a,o,r,h=this.moveX*this._.scale,c=this.moveY*this._.scale,l=t-h-(this.fixed?0:this._.transX),d=e-c-(this.fixed?0:this._.transY);switch(this.type){case"rectangle":case"group":return i=l,n=d,s=this.scaled_x,a=this.scaled_y,o=this.scaled_width,r=this.scaled_height,s<i&&i<s+o&&a<n&&n<a+r;case"arc":var u=this.scaled_x,f=this.scaled_y,g=Math.PI,p=this.startAngle<0?2*g+g/180*this.startAngle:g/180*this.startAngle,v=this.endAngle<0?2*g+g/180*this.endAngle:g/180*this.endAngle;return function(t,e,i,n,s){var a,o,r,h=Math.PI;isNaN(n)||isNaN(s)?o=!!(Math.sqrt(t*t+e*e)<=i):(0<=t&&0<=e?r=0===t?h/2:Math.atan(e/t):t<=0&&0<=e?r=0===t?h:h-Math.atan(e/Math.abs(t)):t<=0&&e<=0?r=0===t?h:Math.atan(Math.abs(e)/Math.abs(t))+h:0<=t&&e<=0&&(r=0===t?3*h/2:2*h-Math.atan(Math.abs(e)/t)),a=Math.sqrt(t*t+e*e),o=n<s?!!(n<=r&&r<=s&&a<=i):!!((0<=r&&r<=s||n<=r&&r<=2*h)&&a<=i));return o}(l-u,d-f,this.scaled_radius,p,v);case"polygon":return function(t,e,i){for(var n=!1,s=0,a=i.length-1;s<i.length;a=s++)i[s][1]>e!=i[a][1]>e&&t<(i[a][0]-i[s][0])*(e-i[s][1])/(i[a][1]-i[s][1])+i[s][0]&&(n=!n);return n}(l,d,this.scaled_matrix);case"line":for(var m=this.scaled_matrix,b=m.length,y=0;y<b;y++)if(0<y&&_(m[y-1][0],m[y-1][1],m[y][0],m[y][1],this.scaled_lineWidth,l,d))return!0;return!1}};var a=function(e){return function(t){return Math.pow(t,e)}},o=function(e){return function(t){return 1-Math.abs(Math.pow(t-1,e))}},r=function(e){return function(t){return t<.5?a(e)(2*t)/2:o(e)(2*t-1)/2+.5}},h=a(2),c=o(2),l=r(2),d=a(3),u=o(3),f=r(3),g=a(4),v=o(4),m=r(4),b=a(5),y=o(5),w=r(5),x=function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},T=function(t){return 1-x(1-t)},M=Object.freeze({linear:function(t){return t},quadIn:h,quadOut:c,quadInOut:l,cubicIn:d,cubicOut:u,cubicInOut:f,quartIn:g,quartOut:v,quartInOut:m,quintIn:b,quintOut:y,quintInOut:w,sineIn:function(t){return 1+Math.sin(Math.PI/2*t-Math.PI/2)},sineOut:function(t){return Math.sin(Math.PI/2*t)},sineInOut:function(t){return(1+Math.sin(Math.PI*t-Math.PI/2))/2},bounceOut:x,bounceIn:T,bounceInOut:function(t){return t<.5?.5*T(2*t):.5*x(2*t-1)+.5}}),j=function(t){var e=t.from,i=t.to,n=t.duration,s=t.delay,a=t.easing,o=t.onStart,r=t.onUpdate,h=t.onFinish;for(var c in e)void 0===i[c]&&(i[c]=e[c]);for(var l in i)void 0===e[l]&&(e[l]=i[l]);this.from=e,this.to=i,this.duration=n||500,this.delay=s||0,this.easing=a||"linear",this.onStart=o,this.onUpdate=r,this.onFinish=h,this.startTime=Date.now()+this.delay,this.started=!1,this.finished=!1,this.keys={}};j.prototype.update=function(){var t=this;if(this.time=Date.now(),!(this.time<this.startTime))if(this.elapsed!==this.duration){for(var e in this.elapsed=this.time-this.startTime,this.elapsed=this.elapsed>this.duration?this.duration:this.elapsed,t.to)t.keys[e]=t.from[e]+(t.to[e]-t.from[e])*M[t.easing](t.elapsed/t.duration);this.started||(this.onStart&&this.onStart(this.keys),this.started=!0),this.onUpdate(this.keys)}else this.finished||(this.finished=!0,this.onFinish&&this.onFinish(this.keys))};var I=function(t,e){this._=e,this.commonData={color:t.color,x:t.x,scaled_x:t.x*e.scale,y:t.y,scaled_y:t.y*e.scale,width:t.width,scaled_width:t.width*e.scale,height:t.height,scaled_height:t.height*e.scale,moveX:0,scaled_moveX:0,moveY:0,scaled_moveY:0,boundingWidth:0,boundingHeight:0,zindex:0}};function k(t,e){var i=new I(t,e);return Object.assign({},i.commonData,{isDragging:!1,hasEnter:!1,hasDraggedIn:!1,on:i.on,animateTo:i.animateTo,isPointInner:i.isPointInner,config:i.config,_:i._,isShape:!0,parent:null,hide:t.hide,animating:!1,forceUpdate:!1,updated:!1,getBounding:function(){return t=this.scaled_matrix,e=this.scaled_lineWidth,i=e||0,n=t.map(function(t){return t[0]}),s=t.map(function(t){return t[1]}),a=p.getMin(n)-i,o=p.getMax(n)+i,r=p.getMin(s)-i,h=p.getMax(s)+i,{lt:[a,r],rt:[o,r],rb:[o,h],lb:[a,h],w:o-a,h:h-r};var t,e,i,n,s,a,o,r,h}})}
/*!
 * @PengJiyuan
 *
 * Two-dimensional coordinate system
 * Matrix transformation
 */I.prototype.on=function(t,e){var i=this;if(!this.isBg){if(!t)throw"no eventTypes defined!";if(!e||"function"!=typeof e)throw"you need defined a callback!";this.events=this.events||[];var n=t.split(" "),s=this;return n.forEach(function(t){if(!~i._.eventTypes.indexOf(t))throw t+" is not in eventTypes!\n Please use event in "+i._.eventTypes;s.events.push({eventType:t,callback:e})}),this}},I.prototype.isPointInner=function(t,e){return s.bind(this)(t,e)},I.prototype.config=function(t){if("[object Object]"===Object.prototype.toString.call(t))return t.drag&&(this.enableDrag=t.drag),t.changeIndex&&(this.enableChangeIndex=t.changeIndex),t.fixed&&(this.fixed=t.fixed),t.bg&&(this.isBg=t.bg),t.cliping&&(this.cliping=t.cliping),this.zindex=t.zindex||0,this},I.prototype.animateTo=function(t,i){var n=this;void 0===i&&(i={}),this.animating=!0;var e={},s=t,a={};for(var o in s)a[o]=n[o];for(var r in e.from=a,e.to=s,e.onUpdate=function(t){for(var e in i.onUpdate&&i.onUpdate(t),s)n[e]=t[e]},i)"onUpdate"!==r&&(e[r]=i[r]);e.onFinish=function(){n.animating=!1,i.onFinish&&i.onFinish(t)};var h=new j(e);return this._.animationList.push(h),this._.tick(),this},I.prototype.drag=function(t){this.enableDrag=t},I.prototype.changeIndex=function(t){this.enableChangeIndex=t};var O=Math.PI,P=Math.cos,A=Math.sin,Y=Math.abs,X=function(t,e,i){void 0===i&&(i=0);var s=function(t,e){void 0===t&&(t=[0,0]);var i=t[0],n=t[1],s=-O/180*e;return[[P(s),-A(s),(1-P(s))*i+n*A(s)],[A(s),P(s),(1-P(s))*n-i*A(s)],[0,0,1]]}(t,i),a=[];return e.forEach(function(t){var e=[t[0],t[1],1],i=s[0][0]*e[0]+s[0][1]*e[1]+s[0][2]*e[2],n=s[1][0]*e[0]+s[1][1]*e[1]+s[1][2]*e[2];a.push([Y(i)<1e-7?0:i,Y(n)<1e-7?0:n])}),a},D=function(e){for(var i=this,t=[],n=arguments.length-1;0<n--;)t[n]=arguments[n+1];t.forEach(function(t){"matrix"===t?i.scaled_matrix=i.matrix.map(function(t){return t.map(function(t){return t*e})}):i["scaled_"+t]=i[t]*e})},E=function(t,e,i,n,s){this.matrix=[[t,e],[t+i,e],[t+i,e+n],[t,e+n]],this.origin=[t+.5*i,e+.5*n],this.scaled_matrix=X(this.origin,this.matrix,s)},S="#555",C={tl:0,tr:0,bl:0,br:0};function F(t,e,i){if(t.cliping){var n=t.getBounding();t.cliping.column?e.rect(n.lt[0],n.lt[1],n.rt[0]-n.lt[0],t.boundingHeight*i):e.rect(n.lt[0],n.lt[1],t.boundingWidth*i,n.rb[1]-n.rt[1]),e.clip()}}var L={arc:function(t,i){return Object.assign({},k(t,i),{type:"arc",draw:function(){var t=i.canvas,e=i.scale;D.call(this,e,"x","y","width","height","moveX","moveY","radius"),t.save(),this.fixed&&t.translate(-i.transX,-i.transY),t.translate(this.scaled_moveX,this.scaled_moveY),t.translate(this.scaled_x,this.scaled_y),this.hide||(t.beginPath(),isNaN(this.startAngle)||isNaN(this.endAngle)?t.arc(0,0,this.scaled_radius,0,2*Math.PI):(t.arc(0,0,this.scaled_radius,Math.PI/180*this.startAngle,Math.PI/180*this.endAngle,!1),t.save(),t.rotate(Math.PI/180*this.endAngle),t.moveTo(this.scaled_radius,0),t.lineTo(0,0),t.restore(),t.rotate(Math.PI/180*this.startAngle),t.lineTo(this.scaled_radius,0)),"fill"===this.style?(t.fillStyle=this.color,t.fill()):(t.strokeStyle=this.color,t.stroke()),t.closePath()),t.restore()},style:t.style,startAngle:t.startAngle,endAngle:t.endAngle,radius:t.radius,scaled_radius:t.radius*i.scale})},image:function(n,s){n.src&&!~s.images.indexOf(n.src)&&s.images.push(n.src);return Object.assign({},k(n,s),{type:"rectangle",draw:function(){var t=s.canvas,e=n.src,i=s.scale;D.call(this,i,"x","y","width","height","moveX","moveY"),t.save(),t.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&t.translate(-s.transX,-s.transY);try{this.hide||(this.sliceWidth&&this.sliceHeight?t.drawImage(s.loader.getImg(e),this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight,this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height):t.drawImage(s.loader.getImg(e),this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height))}catch(t){throw new Error("The picture is not loaded successfully, please check the picture url : "+e)}t.restore()},sliceWidth:n.sliceWidth,sliceHeight:n.sliceHeight,sliceX:n.sliceX,sliceY:n.sliceY})},line:function(c,l){return Object.assign({},k(c,l),{type:"line",draw:function(){var i=l.canvas,t=c.lineCap,e=c.lineJoin,n=c.smooth,s=l.scale;if(this.matrix&&this.matrix.length<2)throw"The line needs at least two points";this.scaled_matrix=this.matrix.map(function(t){return t.map(function(t){return t*s})}),D.call(this,s,"moveX","moveY","lineWidth");var a=this.scaled_matrix;if(i.save(),i.translate(this.scaled_moveX,this.scaled_moveX),this.fixed&&i.translate(-l.transX,-l.transY),F(this,i,s),!this.hide){if(i.beginPath(),i.lineWidth=this.scaled_lineWidth,i.strokeStyle=this.color,i.lineDashOffset=this.offset,this.dash&&p.isArr(this.dash)&&i.setLineDash(this.dash),t&&(i.lineCap=t),e&&(i.lineJoin=e),n)for(var o=function(t,e,i,n){var s,a,o,r;if(i&&n||(n=i=.25),e<1?(s=t[0][0]+(t[1][0]-t[0][0])*i,a=t[0][1]+(t[1][1]-t[0][1])*i):(s=t[e][0]+(t[e+1][0]-t[e-1][0])*i,a=t[e][1]+(t[e+1][1]-t[e-1][1])*i),e>t.length-3){var h=t.length-1;o=t[h][0]-(t[h][0]-t[h-1][0])*n,r=t[h][1]-(t[h][1]-t[h-1][1])*n}else o=t[e+1][0]-(t[e+2][0]-t[e][0])*n,r=t[e+1][1]-(t[e+2][1]-t[e][1])*n;return{pA:{x:s,y:a},pB:{x:o,y:r}}},r=0;r<a.length;r++)if(0===r)i.moveTo(a[r][0],a[r][1]);else{var h=o(a,r-1);i.bezierCurveTo(h.pA.x,h.pA.y,h.pB.x,h.pB.y,a[r].x,a[r].y)}else a.forEach(function(t,e){0===e?i.moveTo(t[0],t[1]):i.lineTo(t[0],t[1])});i.stroke(),i.closePath()}i.restore()},totalLength:void 0,lineWidth:c.lineWidth||1,dash:c.dash,offset:c.offset||0,color:c.color||S,matrix:c.matrix,scaled_matrix:c.matrix})},rectangle:function(t,s){return Object.assign({},k(t,s),{type:"polygon",draw:function(){var t=s.canvas,e=s.scale;if(D.call(this,e,"x","y","width","height","moveX","moveY"),E.call(this,this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height,this.rotate),t.save(),t.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&t.translate(-s.transX,-s.transY),F(this,t,e),!this.hide){t.beginPath();var i=this.scaled_matrix,n=this.radius;t.moveTo(i[0][0]+n.tl*e,i[0][1]),t.lineTo(i[1][0]-n.tr*e,i[0][1]),t.quadraticCurveTo(i[1][0],i[0][1],i[1][0],i[0][1]+n.tr*e),t.lineTo(i[1][0],i[2][1]-n.br*e),t.quadraticCurveTo(i[1][0],i[2][1],i[1][0]-n.br*e,i[2][1]),t.lineTo(i[0][0]+n.bl*e,i[2][1]),t.quadraticCurveTo(i[0][0],i[2][1],i[0][0],i[2][1]-n.bl*e),t.lineTo(i[0][0],i[0][1]+n.tl*e),t.quadraticCurveTo(i[0][0],i[0][1],i[0][0]+n.tl*e,i[0][1]),"stroke"!==this.style?(t.fillStyle=this.color||S,t.fill()):(t.strokeStyle=this.color||S,t.lineWidth=this.lineWidth,t.stroke()),t.closePath()}t.restore()},rotate:t.radius?0:t.rotate,radius:t.radius||C})},text:function(h,c){h.background&&h.background.img&&!~c.images.indexOf(h.background.img)&&c.images.push(h.background.img);return Object.assign({},k(h,c),{type:"rectangle",draw:function(){var t,e,i=c.canvas,n=c.scale,s=h.center,a=h.fontFamily||"arial,sans-serif",o=h.fontSize||14,r="normal "+(h.fontWeight||400)+" "+o*n+"px "+a;D.call(this,n,"x","y","width","height","moveX","moveY","paddingTop","paddingLeft"),i.save(),i.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&i.translate(-c.transX,-c.transY),this.hide||(this.background&&(this.background.color?(i.save(),i.fillStyle=this.background.color,i.fillRect(this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height),i.restore()):this.background.img&&i.drawImage(c.loader.getImg(this.background.img),this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height)),i.font=r,i.textBaseline="top",t=i.measureText(this.text).width,e=function(t,e,i){var n=t.measureText(e).width,s=t.measureText("...").width;if(n<=i||n<=s)return e;for(var a=e.length;i-s<=n&&0<a--;)e=e.substring(0,a),n=t.measureText(e).width;return e+"..."}(i,this.text,this.scaled_width-8),"stroke"===this.style?(i.strokeStyle=this.color,s?t<this.scaled_width-8&&i.strokeText(e,this.scaled_x+this.scaled_paddingLeft+(this.scaled_width-t-8)/2,this.scaled_y+this.scaled_paddingTop):i.strokeText(e,this.scaled_x+this.scaled_paddingLeft,this.scaled_y+this.scaled_paddingTop)):(i.fillStyle=this.color,s?t<this.scaled_width-8&&i.fillText(e,this.scaled_x+this.scaled_paddingLeft+(this.scaled_width-t-8)/2,this.scaled_y+this.scaled_paddingTop):i.fillText(e,this.scaled_x+this.scaled_paddingLeft,this.scaled_y+this.scaled_paddingTop))),i.restore()},color:h.color||S,background:h.background,text:h.text||"no text",style:h.style||"fill",paddingTop:h.paddingTop||0,paddingLeft:h.paddingLeft||0})},polygon:function(t,n){return Object.assign({},k(t,n),{type:"polygon",draw:function(){var i=n.canvas,t=n.scale;D.call(this,t,"moveX","moveY","matrix","lineWidth");var e=this.scaled_matrix;i.save(),i.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&i.translate(-n.transX,-n.transY),this.hide||(i.beginPath(),F(this,i,t),i.closePath(),i.beginPath(),e.forEach(function(t,e){0===e?i.moveTo(t[0],t[1]):i.lineTo(t[0],t[1])}),i.lineTo(e[0][0],e[0][1]),"fill"===this.style?(i.fillStyle=this.color,i.fill()):(i.strokeStyle=this.color,i.lineWidth=this.scaled_lineWidth,i.stroke()),i.closePath()),i.restore()},style:t.style||"fill",color:t.color||S,lineWidth:t.lineWidth||1,matrix:t.matrix,scaled_matrix:t.matrix})}},W=Object.freeze({display:k,DefineScale:D,DefineMatrix:E}),q=function(t){this.version="3.1.1",this.objects=[],this.groupRecords=0,this.transX=0,this.transY=0,this.deviceScale=1,this.minDeviceScale=.5*this.deviceScale,this.maxDeviceScale=4*this.deviceScale,this.scale=this.deviceScale,this.loader=null,this.prepareImage=t.prepareImage,this.pointerInnerArray=[],this.globalMousedown=void 0,this.globalMousemove=void 0,this.isDragging=!1,this.Tween=j,this.animationList=[],this.animationId=null,this.animating=!1,this.fpsFunc=null,this.fps=0,this.fpsCacheTime=0,this.eventTypes=["mousedown","mouseup","mouseenter","mouseleave","mousemove","drag","dragend","dragin","dragout","drop"],this._event=new e(this),this.color=new i,this.element=t.element,this.canvas=this.element.getContext("2d"),this.width=t.width,this.height=t.height,n([this.element],{width:this.width,height:this.height,position:t.position||"relative"}),this.ext=W,this.clip=F,this.enableGlobalTranslate=t.enableGlobalTranslate||!1,this.enableGlobalScale=t.enableGlobalScale||!1,this.images=t.images||[],this.utils=p,this.shapes=L};q.prototype.init=function(){var t=this;Object.keys(this.shapes).forEach(function(e){t[e]=function(t){return this.shapes[e](t,this)}}),this.group=function(t){return e=t,l=this,Object.assign({},k(e,l),{type:"group",draw:function(){var t=l.canvas,e=l.scale;D.call(this,e,"x","y","width","height","moveX","moveY"),E.call(this,this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height),t.save(),t.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&t.translate(-l.transX,-l.transY),t.beginPath();var i=this.scaled_matrix,n=this.radius;if(t.moveTo(i[0][0]+n.tl*e,i[0][1]),t.lineTo(i[1][0]-n.tr*e,i[0][1]),t.quadraticCurveTo(i[1][0],i[0][1],i[1][0],i[0][1]+n.tr*e),t.lineTo(i[1][0],i[2][1]-n.br*e),t.quadraticCurveTo(i[1][0],i[2][1],i[1][0]-n.br*e,i[2][1]),t.lineTo(i[0][0]+n.bl*e,i[2][1]),t.quadraticCurveTo(i[0][0],i[2][1],i[0][0],i[2][1]-n.bl*e),t.lineTo(i[0][0],i[0][1]+n.tl*e),t.quadraticCurveTo(i[0][0],i[0][1],i[0][0]+n.tl*e,i[0][1]),p.isObj(this.background)){var s=this.background;s.color&&(t.fillStyle=s.color||S,t.fill())}else if(p.isObj(this.border)){var a=this.border;t.strokeStyle=a.color||S,t.lineWidth=a.lineWidth||1,t.stroke()}t.closePath();var o=this.title;if(o&&"object"==typeof o){var r=o.fontSize||14,h=o.paddingTop||4,c=o.paddingLeft||2;t.fillStyle="#000",t.textBaseline="top",t.font="normal 400 "+r*e+"px "+(o.fontFamily||"arial,sans-serif"),t.fillText(o.text,this.scaled_x+c*e,this.scaled_y+h*e)}t.restore()},background:e.background,border:e.border,radius:e.radius||C,title:e.title,children:[],add:function(t){var i=this;if(!p.isArr(t))throw"The parameter must be an array";if(!~this._.objects.indexOf(this))throw"before add, please addChild the parent!";t.sort(function(t,e){return t.zindex-e.zindex}),t.forEach(function(t){var e;t.isShape&&((t.parent=i)._.groupRecords+=1e-10,t.zindex=i.zindex+i._.groupRecords,(e=t).updated&&!e.forceUpdate||(e.updated=!0,e.moveX=e.parent.x+e.parent.moveX,e.moveY=e.parent.y+e.parent.moveY,e.enableChangeIndex=!1,e.fixed=!1,e.drag=!1),i.enableDrag=!1,i.children.push(t))}),p.insertArray(this._.objects,this._.objects.indexOf(this)+1,0,t),this._._objects=p.reverse(this._.objects)},remove:function(t){var i=this,e=t;"function"==typeof t?e=this.children.filter(t):p.isArr(t)||(e=[t]),e.forEach(function(e){var t=i.children.indexOf(e);~t&&(e.parent=null,i.children.splice(t,1),i._.objects=i._.objects.filter(function(t){return t!==e}),i._._objects=p.reverse(i._.objects))})},updateAllChildsPosition:function(){this.children.forEach(function(t){t.moveX=t.parent.x+t.parent.moveX,t.moveY=t.parent.y+t.parent.moveY})}});var e,l}},q.prototype.extend=function(t){for(var e in t)this.shapes[e]=t[e]},q.prototype.addChild=function(t){p.isArr(t)?this.objects=this.objects.concat(t):this.objects.push(t),this.objects.sort(function(t,e){return t.zindex-e.zindex}),this._objects=p.reverse(this.objects)},q.prototype.removeChild=function(e){p.isArr(e)?this.objects=this.objects.filter(function(t){return!~e.indexOf(t)}):this.objects=this.objects.filter(function(t){return t!==e}),this._objects=p.reverse(this.objects)},q.prototype.removeFirstChild=function(){this.objects.pop(),this._objects=p.reverse(this.objects)},q.prototype.removeLastChild=function(){this.objects.shift(),this._objects=p.reverse(this.objects)},q.prototype.removeAllChilds=function(){this.objects=[],this._objects=[]},q.prototype.imgReady=function(){this.loader=new t,this.loader.addImg(this.images)},q.prototype.show=function(){var t=this;this.prepareImage?(this.imgReady(),this.loader.ready(function(){t.draw(),t._event.triggerEvents()})):(this.draw(),this._event.triggerEvents())},q.prototype.draw=function(){this.objects.forEach(function(t){t.draw()})},q.prototype.redraw=function(){this.clear(),this.canvas.save(),this.canvas.translate(this.transX,this.transY),this.draw(),this.canvas.restore()},q.prototype.clear=function(){this.canvas.clearRect(0,0,this.width,this.height)},q.prototype.tick=function(){var i=this,e=function(){if(i.fpsFunc){var t=Date.now();1e3<=t-i.fpsCacheTime?(i.fpsFunc(i.fps),i.fps=0,i.fpsCacheTime=t):i.fps++}i.animationList.forEach(function(t,e){t.finished?i.animationList.splice(e--,1):t.update?t.update():t()}),i.redraw(),0===i.animationList.length&&i.animating?(i.animating=!1,cancelAnimationFrame(i[i.animationId])):i[i.animationId]=requestAnimationFrame(e)};return 0<this.animationList.length&&!this.animating&&(this.animating=!0,this.animationId=Date.now(),e()),this.animationId},q.prototype.fpsOn=function(t){this.fpsFunc=t,this.fpsCacheTime=Date.now()},q.prototype.fpsOff=function(){this.fpsFunc=null,this.fps=0},q.prototype.animate=function(t){this._event.triggerEvents(),this.animationList.push(t),this.tick()},q.prototype.clearAnimation=function(){this.animationList=[],this.animating=!1,cancelAnimationFrame(this[this.animationId])},q.prototype.getVersion=function(){return this.version},q.prototype.mousedown=function(t){this.globalMousedown=t},q.prototype.mousemove=function(t){this.globalMousemove=t},q.prototype.resize=function(t){var e=this,i=function(){e.width=t.width(),e.height=t.height(),n([e.element],{width:e.width,height:e.height,position:"absolute"}),e.redraw()};window.onresize||p.bind(window,"resize",function(){t.resize?t.resize(i):i()})};return function(t){return new q(t)}});
