/*!
 * @Project: lcl
 * @Version: v1.0.0 
 * @Author: PengJiyuan 
 * @Date: 2016-12-28
 * @license: MIT
 *
 * @homepage: https://github.com/PengJiyuan/LCL#readme
 */
!function(){var a={version:"1.0.0",objects:[],canvas:null,transX:0,transY:0,scale:1,drawUtils:{},eventTypes:["mousedown","mouseup","mouseenter","mouseleave","mousemove"],core:function(b){return b instanceof Object?(a.element=this.element=b.element,this.canvas=a.canvas=this.element.getContext("2d"),b.element.width=this.width=a.width=b.width,b.element.height=this.height=a.height=b.height,a.drawUtils.clear=this.clear,a.drawUtils.draw=this.draw,void(a.drawUtils.redraw=this.redraw)):void console.warn("no canvas element!")},init:function(b){return new a.core(b)}};a.core.prototype={addChild:function(b){a.objects.push(b)},show:function(){a.drawUtils.draw(),a.event.triggerEvents()},draw:function(){a.objects.forEach(function(a){a.draw()})},redraw:function(){a.drawUtils.clear(),a.canvas.save(),a.canvas.translate(a.transX,a.transY),a.canvas.scale(a.scale,a.scale),a.drawUtils.draw(),a.canvas.restore()},clear:function(){a.canvas.clearRect(0,0,a.width,a.height)},animate:function(b,c){a.event.triggerEvents();var d=(new Date).getTime(),e=function(){b(),a[d]=requestAnimationFrame(e)};return e(),d},stop:function(b){cancelAnimationFrame(a[b])},dragCanvas:function(b){if("boolean"==typeof b&&b){var c=this,d=function(b){c.cacheX=a.event.getPos(b).x,c.cacheY=a.event.getPos(b).y,a.bind(document,"mousemove",e),a.bind(document,"mouseup",f)},e=function(b){var d=a.event.getPos(b).x,e=a.event.getPos(b).y;a.transX=a.transX+d-c.cacheX,a.transY=a.transY+e-c.cacheY,c.redraw(),c.cacheX=d,c.cacheY=e},f=function(){a.unbind(document,"mousemove",e),a.unbind(document,"mouseup",f)};a.bind(a.element,"mousedown",d)}},scaleCanvas:function(b){if("boolean"==typeof b&&b){var c=this;a.bind(this.element,"wheel",function(b){b.deltaY<0?a.scale<=3&&(a.scale+=.02,c.redraw()):a.scale>.5&&(a.scale-=.02,c.redraw())})}}},a.display=function(b){var c={startX:b.startX,startY:b.startY,width:b.width,height:b.height,fillColor:b.fillColor},d=function(b,c){if(!b)throw"no eventTypes defined!";if(!c||"function"!=typeof c)throw"you need defined a callback!";this.events=this.events||[];var d=b.split(" "),e=this;return d.forEach(function(b){~a.eventTypes.indexOf(b)?e.events.push({eventType:b,callback:c}):console.warn(b+" is not in eventTypes!")}),this},e=function(b,c){var d=this,e=b>d.startX*a.scale+a.transX+this.moveX,f=b<(d.startX+d.width)*a.scale+a.transX+this.moveX,g=c>d.startY*a.scale+a.transY+this.moveY,h=c<(d.startY+d.height)*a.scale+a.transY+this.moveY;switch(this.type){case"rectangle":return!!(e&&f&&g&&h)}},f=function(a){a&&"boolean"==typeof a&&(this.enableDrag=!0)};return Object.assign({},c,{hasEnter:!1,rotate:0,moveX:0,moveY:0,events:this.events,on:d,isPointInner:e,drag:f})},function(){var b=function(b){var c=function(){var c=a.canvas,d=b.startX,e=b.startY,f=b.width,g=b.height;c.save(),c.translate(d+f/2+this.moveX,e+g/2+this.moveY),c.rotate(Math.PI/180*this.rotate),c.translate(-(d+f/2+this.moveX),-(e+g/2+this.moveY)),c.translate(this.moveX,this.moveY),c.fillStyle=this.fillColor?this.fillColor:"#000",c.fillRect(d,e,f,g),c.restore()};return Object.assign({},a.display(b),{type:"rectangle",draw:c})};a.rectangle=b}(),function(){var b=function(b){var c=function(){var c=a.canvas,d=b.startX,e=b.startY,f=b.endX,g=b.endY;c.save(),c.translate(d+(f-d)/2,e+(g-e)/2),c.rotate(Math.PI/180*this.rotate),c.translate(-(d+(f-d)/2),-(e+(g-e)/2)),c.translate(this.moveX,this.moveY),c.beginPath(),c.moveTo(d,e),c.lineTo(f,g),c.stroke(),c.closePath(),c.restore()};return Object.assign({},a.display(b),{type:"line",draw:c})};a.line=b}(),a.event=function(){return{getPos:function(b){var b=b||event,c=b.pageX-a.element.offsetLeft,d=b.pageY-a.element.offsetTop;return{x:c,y:d}},triggerEvents:function(){var b=this,c=a.objects.some(function(a){return!!a.events&&"[object Array]"===Object.prototype.toString.call(a.events)});a.objects.some(function(a){return!!a.enableDrag});if(c){var d=a.objects.some(function(a){return a.events&&a.events.some(function(a){return"mouseenter"===a.eventType||"mousemove"===a.eventType})});d&&a.bind(a.element,"mousemove",function(b){var c=a.event.getPos(b).x,d=a.event.getPos(b).y;a.objects.filter(function(a){return a.events&&a.events.some(function(a){return"mouseenter"===a.eventType||"mousemove"===a.eventType})}).forEach(function(a){a.isPointInner(c,d)?(a.hasEnter=!0,a.events.forEach(function(a){"mouseenter"!==a.eventType&&"mousemove"!==a.eventType||a.callback&&a.callback()})):(a.hasEnter&&a.events.forEach(function(a){"mouseleave"===a.eventType&&a.callback&&a.callback()}),a.hasEnter=!1)})});var e=function(c){var d=a.event.getPos(c).x,e=a.event.getPos(c).y;b.cacheX=d,b.cacheY=e,a.objects.filter(function(a){return!!a.events&&"[object Array]"===Object.prototype.toString.call(a.events)}).some(function(a){return a.isPointInner(d,e)&&a.events[0].callback&&a.events[0].callback()}),a.objects.filter(function(a){return!!a.enableDrag}).forEach(function(c){var d=function(d){var e=a.event.getPos(d).x,f=a.event.getPos(d).y;c.isPointInner(e,f)&&(a.element.style.cursor="pointer",c.moveX=c.moveX+e-b.cacheX,c.moveY=c.moveY+f-b.cacheY,a.drawUtils.redraw(),b.cacheX=e,b.cacheY=f)},e=function(){a.element.style.cursor="default",a.unbind(document,"mousemove",d),a.unbind(document,"mouseup",e)};a.bind(document,"mousemove",d),a.bind(document,"mouseup",e)})};a.bind(a.element,"mousedown",e)}}}}(),a.bind=function(a,b,c){return window.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c,a},a.unbind=function(a,b,c){window.removeEventListener?a.removeEventListener(b,c,!1):window.detachEvent?a.detachEvent(b,c):a["on"+b]=""},function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),"object"==typeof exports&&"object"==typeof module?module.exports=a:window.LCL=a}();