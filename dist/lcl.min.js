/*!
 * @Project: lcl
 * @Version: v1.1.1 
 * @Author: PengJiyuan 
 * @Date: 2017-01-05
 * @license: MIT
 *
 * @homepage: https://github.com/PengJiyuan/LCL#readme
 */
!function(){var a={version:"1.1.1",objects:[],canvas:null,transX:0,transY:0,scale:1,drawUtils:{},isDragging:!1,eventTypes:["mousedown","mouseup","mouseenter","mouseleave","mousemove","dragin","dragout","drop"],core:function(b){return b instanceof Object?(a.element=this.element=b.element,this.canvas=a.canvas=this.element.getContext("2d"),b.element.width=this.width=a.width=b.width,b.element.height=this.height=a.height=b.height,a.enableGlobalTranslate=b.enableGlobalTranslate,a.drawUtils.clear=this.clear,a.drawUtils.draw=this.draw,void(a.drawUtils.redraw=this.redraw)):void console.warn("no canvas element!")},init:function(b){return new a.core(b)}};a.core.prototype={addChild:function(b){a.objects.push(b),a._objects=a.reverse(a.objects)},show:function(){a.drawUtils.draw(),a.event.triggerEvents()},draw:function(){a.objects.forEach(function(a){a.draw()})},redraw:function(){a.drawUtils.clear(),a.canvas.save(),a.canvas.translate(a.transX,a.transY),a.canvas.scale(a.scale,a.scale),a.drawUtils.draw(),a.canvas.restore()},clear:function(){a.canvas.clearRect(0,0,a.width,a.height)},animate:function(b,c){a.event.triggerEvents();var d=(new Date).getTime(),e=function(){b(),a[d]=requestAnimationFrame(e)};return e(),d},stop:function(b){cancelAnimationFrame(a[b])},globalTranslate:function(b){"boolean"==typeof b&&b&&(a.enableGlobalTranslate=!0)}},a.display=function(b){var c={startX:b.startX,startY:b.startY,width:b.width,height:b.height,fillColor:b.fillColor},d=function(b,c){if(!b)throw"no eventTypes defined!";if(!c||"function"!=typeof c)throw"you need defined a callback!";this.events=this.events||[];var d=b.split(" "),e=this;return d.forEach(function(b){~a.eventTypes.indexOf(b)?e.events.push({eventType:b,callback:c}):console.warn(b+" is not in eventTypes!")}),this},e=function(b,c){var d=this.startX+this.width/2+a.transX+this.moveX,e=this.startY+this.height/2+a.transY+this.moveY,f=(b-d)*Math.cos(Math.PI/180*-this.rotate)-(c-e)*Math.sin(Math.PI/180*-this.rotate)+d,g=(b-d)*Math.sin(Math.PI/180*-this.rotate)+(c-e)*Math.cos(Math.PI/180*-this.rotate)+e,h=f>this.startX+a.transX+this.moveX,i=f<this.startX+this.width+a.transX+this.moveX,j=g>this.startY+a.transY+this.moveY,k=g<this.startY+this.height+a.transY+this.moveY;switch(this.type){case"rectangle":return!!(h&&i&&j&&k)}},f=function(a){if("[object Object]"===Object.prototype.toString.call(a))return a.drag&&(this.enableDrag=!0),a.changeIndex&&(this.enableChangeIndex=!0),this},g=function(a){a&&"boolean"==typeof a&&(this.enableDrag=!0)},h=function(a){a&&"boolean"==typeof a&&(this.enableChangeIndex=!0)};return Object.assign({},c,{isDragging:!1,hasEnter:!1,hasDraggedIn:!1,rotate:0,moveX:0,moveY:0,on:d,isPointInner:e,config:f,drag:g,changeIndex:h})},function(){var b=function(b){var c=function(){var c=a.canvas,d=b.startX,e=b.startY,f=b.width,g=b.height;c.save(),c.translate(d+f/2+this.moveX,e+g/2+this.moveY),c.rotate(Math.PI/180*this.rotate),c.translate(-(d+f/2+this.moveX),-(e+g/2+this.moveY)),c.translate(this.moveX,this.moveY),c.fillStyle=this.fillColor?this.fillColor:"#000",c.fillRect(d,e,f,g),c.restore()};return Object.assign({},a.display(b),{type:"rectangle",draw:c})};a.rectangle=b}(),function(){var b=function(b){var c=function(){var c=a.canvas,d=b.startX,e=b.startY,f=b.endX,g=b.endY;c.save(),c.translate(d+(f-d)/2,e+(g-e)/2),c.rotate(Math.PI/180*this.rotate),c.translate(-(d+(f-d)/2),-(e+(g-e)/2)),c.translate(this.moveX,this.moveY),c.beginPath(),c.moveTo(d,e),c.lineTo(f,g),c.stroke(),c.closePath(),c.restore()};return Object.assign({},a.display(b),{type:"line",draw:c})};a.line=b}(),a.event=function(){return{getPos:function(b){var b=b||event,c=b.pageX-a.element.offsetLeft,d=b.pageY-a.element.offsetTop;return{x:c,y:d}},triggerEvents:function(){var b=a.objects.some(function(a){return!!a.events&&"[object Array]"===Object.prototype.toString.call(a.events)});if(b){var c=a.objects.some(function(a){return a.events&&a.events.some(function(a){return"mouseenter"===a.eventType||"mousemove"===a.eventType})});c&&this.mouseEnterOrMove(),a.bind(a.element,"mousedown",this.mouseDown.bind(this))}},mouseEnterOrMove:function(){var b;a.bind(a.element,"mousemove",function(c){var d=a.event.getPos(c).x,e=a.event.getPos(c).y;b=a.objects.some(function(a){return a.isDragging});var f=a._objects.filter(function(a){return a.isPointInner(d,e)});if(f&&f.length>0?a.element.style.cursor="pointer":a.element.style.cursor="default",b){f&&f.length>1&&f[1].events.forEach(function(a){"dragin"!==a.eventType||f[1].hasDraggedIn||(f[1].hasDraggedIn=!0,a.callback&&a.callback())});var g=function(a){a.hasDraggedIn&&a.events.forEach(function(a){"dragout"===a.eventType&&a.callback&&a.callback()}),a.hasDraggedIn=!1};a._objects.some(function(a){return a.hasDraggedIn&&(!a.isPointInner(d,e)||f[1]!==a)&&g(a)})}else{f&&f.length>0&&f[0].events.forEach(function(a){"mouseenter"!==a.eventType||f[0].hasEnter?"mousemove"===a.eventType&&a.callback&&a.callback():(f[0].hasEnter=!0,a.callback&&a.callback())});var h=function(a){a.hasEnter&&a.events.forEach(function(a){"mouseleave"===a.eventType&&a.callback&&a.callback()}),a.hasEnter=!1};a._objects.some(function(a){return a.hasEnter&&(!a.isPointInner(d,e)||f[0]!==a)&&h(a)})}})},mouseDown:function(b){var c,d=this,e=a.objects.some(function(a){return!!a.enableDrag}),f=a.event.getPos(b).x,g=a.event.getPos(b).y;d.cacheX=f,d.cacheY=g;var h=a._objects.filter(function(a){return!!a.events&&a.isPointInner(f,g)});if(h&&h.length>0&&(h[0].enableChangeIndex&&d.changeOrder(h[0]),h[0].events.some(function(a){return"mousedown"===a.eventType&&a.callback&&a.callback()})),e){c=a._objects.filter(function(a){return a.enableDrag&&a.isPointInner(f,g)});var i=function(b){var e=a.event.getPos(b).x,f=a.event.getPos(b).y;a.element.style.cursor="pointer",c[0].moveX=c[0].moveX+e-d.cacheX,c[0].moveY=c[0].moveY+f-d.cacheY,a.drawUtils.redraw(),d.cacheX=e,d.cacheY=f,c[0].isDragging=!0},j=function(b){var d=a.event.getPos(b).x,e=a.event.getPos(b).y,f=a._objects.filter(function(a){return a.isPointInner(d,e)});if(f&&f.length>1&&f[1].hasDraggedIn){f[1].hasDraggedIn=!1;var g=f[1].events.some(function(a){return"drop"===a.eventType&&a.callback&&a.callback()});!g&&f[1].events.some(function(a){return"dragout"===a.eventType&&a.callback&&a.callback()})}a.unbind(document,"mousemove",i),a.unbind(document,"mouseup",j),c[0].isDragging=!1};c&&c.length>0&&(a.bind(document,"mousemove",i),a.bind(document,"mouseup",j))}if(a.enableGlobalTranslate&&!(c.length>0)){var k=function(b){var c=a.event.getPos(b).x,e=a.event.getPos(b).y;a.transX=a.transX+c-d.cacheX,a.transY=a.transY+e-d.cacheY,a.drawUtils.redraw(),d.cacheX=c,d.cacheY=e},l=function(){a.unbind(document,"mousemove",k),a.unbind(document,"mouseup",l)};a.bind(document,"mousemove",k),a.bind(document,"mouseup",l)}},changeOrder:function(b){var c=a.objects.indexOf(b),d=a.objects[c];a.objects.splice(c,1),a.objects.push(d),a._objects=a.reverse(a.objects),a.drawUtils.redraw()}}}(),a.bind=function(a,b,c){try{return window.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c,a}catch(a){console.log(a)}},a.unbind=function(a,b,c){try{window.removeEventListener?a.removeEventListener(b,c,!1):window.detachEvent?a.detachEvent(b,c):a["on"+b]=""}catch(a){console.log(a)}},a.reverse=function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d]=a[b-d-1];return c},function(){var a=0,b=["ms","moz","webkit","o"];try{for(var c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}catch(a){console.log(a)}}(),"object"==typeof exports&&"object"==typeof module?module.exports=a:window.LCL=a}();