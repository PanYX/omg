/*!
 * omg.js v3.1.4
 * Author: PengJiyuan
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.omg=t()}(this,function(){"use strict";!function(){for(var e=["ms","moz","webkit","o"],s=0,t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),i=Math.max(0,16-(t-s)),n=window.setTimeout(function(){e(t+i)},i);return s=t+i,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var s=arguments[n];if(null!=s)for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])}return i},writable:!0,configurable:!0})}();var i="3.1.4",f={getPos:function(e){var t=e||event,i=[t.offsetX,t.offsetY];return{x:i[0],y:i[1]}},bind:function(e,t,i){return window.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i,e},unbind:function(e,t,i){window.removeEventListener?e.removeEventListener(t,i,!1):window.detachEvent?e.detachEvent(t,i):e["on"+t]=""},reverse:function(e){for(var t=[e.length,[]],i=t[0],n=t[1],s=0;s<i;s++)n[s]=e[i-s-1];return n},formatFloat:function(e){var t=Math.pow(10,10);return parseInt(e*t,10)/t},getMax:function(e){return Math.max.apply(null,e)},getMin:function(e){return Math.min.apply(null,e)},insertArray:function(e,t,i,n){var s=[t,i].concat(n);Array.prototype.splice.apply(e,s)},isArr:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObj:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=(function(){function l(e){this.value=e}function e(s){var a,r;function o(e,t){try{var i=s[e](t),n=i.value;n instanceof l?Promise.resolve(n.value).then(function(e){o("next",e)},function(e){o("throw",e)}):h(i.done?"return":"normal",i.value)}catch(e){h("throw",e)}}function h(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}(a=a.next)?o(a.key,a.arg):r=null}this._invoke=function(n,s){return new Promise(function(e,t){var i={key:n,arg:s,resolve:e,reject:t,next:null};r?r=r.next=i:(a=r=i,o(n,s))})},"function"!=typeof s.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(e){return this._invoke("next",e)},e.prototype.throw=function(e){return this._invoke("throw",e)},e.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),s=function(){function t(e){d(this,t),this._=e,this.triggeredMouseDown=!1,this.triggeredMouseMove=!1}return n(t,[{key:"getPos",value:function(e){var t=e||event,i=[t.offsetX,t.offsetY];return{x:i[0],y:i[1]}}},{key:"triggerEvents",value:function(){if(this._.objects.filter(function(e){return!e.hide}).some(function(e){return e.events&&f.isArr(e.events)||e.enableDrag})||this._.enableGlobalTranslate||this._.enableGlobalScale){var e=this._.objects.some(function(e){return e.events&&e.events.some(function(e){return"mouseenter"===e.eventType||"mousemove"===e.eventType||"drag"===e.eventType||"dragin"===e.eventType||"dragout"===e.eventType||"drop"===e.eventType})})||this._.globalMousemove;e&&!this.triggeredMouseMove&&(this.bindMouseMove(),this.triggeredMouseMove=!0),!e&&this.triggeredMouseMove&&(this.unBindMouseMove(),this.triggeredMouseMove=!1),this.triggeredMouseDown||(f.bind(this._.element,"mousedown",this.mouseDown.bind(this)),this.triggeredMouseDown=!0),this._.enableGlobalScale?this.bindMouseWheel():this.unBindMouseWheel()}}},{key:"bindMouseWheel",value:function(){f.bind(this._.element,"wheel",this.mouseWheel.bind(this))}},{key:"unBindMouseWheel",value:function(){f.unbind(this._.element,"wheel",this.mouseWheel.bind(this))}},{key:"mouseWheel",value:function(e){e.deltaY&&0<e.deltaY?this._.scale=this._.scale-.01>=this._.minDeviceScale?this._.scale-.01:this._.minDeviceScale:e.deltaY&&e.deltaY<0&&(this._.scale=this._.scale+.01<=this._.maxDeviceScale?this._.scale+.01:this._.maxDeviceScale),this._.redraw()}},{key:"bindMouseMove",value:function(){f.bind(this._.element,"mousemove",this.mouseEnterOrMove.bind(this))}},{key:"unBindMouseMove",value:function(){f.unbind(this._.element,"mousemove",this.mouseEnterOrMove.bind(this))}},{key:"mouseEnterOrMove",value:function(e){var t,i=this,n=i.getPos(e).x,s=i.getPos(e).y;i._.globalMousemove&&i._.globalMousemove(e),t=i._.objects.some(function(e){return e.isDragging});var a=i._._objects.filter(function(e){return e.isPointInner(n,s)&&!e.hide});if(t){a&&1<a.length&&a[1].events&&a[1].events.forEach(function(e){"dragin"!==e.eventType||a[1].hasDraggedIn||(a[1].hasDraggedIn=!0,e.callback&&e.callback(a[1]))});i._._objects.some(function(e){return e.hasDraggedIn&&(!e.isPointInner(n,s)||a[1]!==e)&&((t=e).hasDraggedIn&&t.events.forEach(function(e){"dragout"===e.eventType&&e.callback&&e.callback(a[1])}),void(t.hasDraggedIn=!1));var t})}else{i._._objects.some(function(e){return e.hasEnter&&(!e.isPointInner(n,s)||a[0]!==e)&&((t=e).hasEnter&&t.events.forEach(function(e){"mouseleave"===e.eventType&&e.callback&&e.callback(t)}),void(t.hasEnter=!1));var t}),a&&0<a.length&&a[0].events&&a[0].events.forEach(function(e){"mouseenter"!==e.eventType||a[0].hasEnter?"mousemove"===e.eventType&&e.callback&&e.callback(a[0]):(a[0].hasEnter=!0,e.callback&&e.callback(a[0]))})}}},{key:"mouseDown",value:function(e){var a=this,r=void 0,n=void 0,o=void 0,s=void 0,h=void 0;this._.globalMousedown&&this._.globalMousedown(e);var t=this._.objects.filter(function(e){return!e.hide}).some(function(e){return e.enableDrag}),i=this.getPos(e).x,l=this.getPos(e).y;a.cacheX=i,a.cacheY=l;var c=this._._objects.filter(function(e){return e.isPointInner(i,l)&&!e.isBg&&!e.hide});if(c&&0<c.length&&(c[0].enableChangeIndex&&a.changeOrder(c[0]),c[0].events&&c[0].events.some(function(e){return"mousedown"===e.eventType&&e.callback&&e.callback(c[0])})),t){r=a._._objects.filter(function(e){return!e.hide}).filter(function(e){return e.isPointInner(i,l)&&!e.isBg}),n=0<r.length&&r[0].events&&r[0].events.some(function(e){return"drag"===e.eventType&&(s=e.callback),"drag"===e.eventType}),o=0<r.length&&r[0].events&&r[0].events.some(function(e){return"dragend"===e.eventType&&(h=e.callback),"dragend"===e.eventType});var u=function(e){var t=a.getPos(e).x,i=a.getPos(e).y;r[0].moveX=r[0].moveX+t-a.cacheX,r[0].moveY=r[0].moveY+i-a.cacheY,n&&s(c[0]),a._.redraw(),a.cacheX=t,a.cacheY=i,r[0].isDragging=!0};r&&0<r.length&&r[0].enableDrag&&(f.bind(document,"mousemove",u),f.bind(document,"mouseup",function e(t){var i=a.getPos(t).x,n=a.getPos(t).y,s=a._._objects.filter(function(e){return e.isPointInner(i,n)});s&&1<s.length&&s[1].hasDraggedIn&&(s[1].hasDraggedIn=!1,!s[1].events.some(function(e){return"drop"===e.eventType&&e.callback&&e.callback(s[1],s[0])})&&s[1].events.some(function(e){return"dragout"===e.eventType&&e.callback&&e.callback(s[1])}));o&&h(c[0]),f.unbind(document,"mousemove",u),f.unbind(document,"mouseup",e),r[0].isDragging=!1}))}if(this._.enableGlobalTranslate&&!(r&&0<r.length)){var d=function(e){var t=a.getPos(e).x,i=a.getPos(e).y;a._.transX=a._.transX+t-a.cacheX,a._.transY=a._.transY+i-a.cacheY,a._.redraw(),a.cacheX=t,a.cacheY=i};f.bind(document,"mousemove",d),f.bind(document,"mouseup",function e(){f.unbind(document,"mousemove",d),f.unbind(document,"mouseup",e)})}}},{key:"changeOrder",value:function(e){var t=this._.objects.indexOf(e),i=this._.objects[t];this._.objects.splice(t,1),this._.objects.push(i),this._._objects=f.reverse(this._.objects),this._.redraw()}}]),t}(),a=function(){function e(){d(this,e)}return n(e,[{key:"hexToRGB",value:function(e){var t=[];return 3===(e=e.substr(1)).length&&(e=e.replace(/(.)/g,"$1$1")),e.replace(/../g,function(e){t.push(parseInt(e,16))}),{r:t[0],g:t[1],b:t[2],rgb:"rgb("+t.join(",")+")"}}},{key:"rgbToHSL",value:function(e,t,i){e/=255,t/=255,i/=255;var n=Math.max(e,t,i),s=Math.min(e,t,i),a=void 0,r=void 0,o=(n+s)/2;if(n==s)a=r=0;else{var h=n-s;switch(r=.5<o?h/(2-n-s):h/(n+s),n){case e:a=(t-i)/h+(t<i?6:0);break;case t:a=(i-e)/h+2;break;case i:a=(e-t)/h+4}a/=6}return{h:a,s:r,l:o,hsl:"hsl("+360*a+", "+100*r+"%, "+100*o+"%)"}}},{key:"hslToRGB",value:function(){}},{key:"lighten",value:function(e,t){var i=void 0,n=void 0,s=void 0;if(e&&t&&/^[0-9]{1,2}%$/.test(t))return this.isRgba(e)?(s=+(n=this.getRgba(e)).a-+t.slice(0,-1)/100,"rgba("+n.r+", "+n.g+", "+n.b+", "+s+")"):"hsl("+360*+(i=this.getHsl(e)).h+", "+100*+i.s+"%, "+(100*+i.l+ +t.slice(0,-1))+"%)"}},{key:"darken",value:function(e,t){var i=void 0,n=void 0,s=void 0;if(e&&t&&/^[0-9]{1,2}%$/.test(t))return this.isRgba(e)?(s=+(n=this.getRgba(e)).a+ +t.slice(0,-1)/100,"rgba("+n.r+", "+n.g+", "+n.b+", "+s+")"):"hsl("+360*+(i=this.getHsl(e)).h+", "+100*+i.s+"%, "+(100*+i.l-+t.slice(0,-1))+"%)"}},{key:"isHex",value:function(e){return/^#[a-fA-F0-9]{3}$|#[a-fA-F0-9]{6}$/.test(e)}},{key:"isRgb",value:function(e){return/^rgb\((\s*[0-5]{0,3}\s*,?){3}\)$/.test(e)}},{key:"isRgba",value:function(e){return/^rgba\((\s*[0-5]{0,3}\s*,?){3}[0-9.\s]*\)$/.test(e)}},{key:"getRgb",value:function(e){var t=void 0,i=void 0,n=void 0,s=void 0;if(this.isHex(e)){var a=[(t=this.hexToRGB(e)).r,t.g,t.b];i=a[0],n=a[1],s=a[2]}else if(this.isRgb(e)){var r=[(t=e.slice(4,-1).split(","))[0],t[1],t[2]];i=r[0],n=r[1],s=r[2]}return{r:i,g:n,b:s}}},{key:"getRgba",value:function(e){var t,i=[(t=e.slice(5,-1).split(","))[0],t[1],t[2],t[3]];return{r:i[0],g:i[1],b:i[2],a:i[3]}}},{key:"getHsl",value:function(e){var t,i,n,s,a,r=[(i=this.getRgb(e)).r,i.g,i.b];n=r[0],s=r[1],a=r[2];var o=[(t=this.rgbToHSL(n,s,a)).h,t.s,t.l];return{h:o[0],s:o[1],l:o[2]}}}]),e}(),e=function(){function e(){d(this,e),this.imageList=[],this.loadNum=0}return n(e,[{key:"ready",value:function(e){var t=this;this.imageList.forEach(function(e){t.loadImg(e)});var i=setInterval(function(){t.loadNum===t.imageList.length&&(clearInterval(i),e&&e())},50)}},{key:"loadImg",value:function(e){var t=this,i=setInterval(function(){!0===e.complete&&(t.loadNum++,clearInterval(i))},50)}},{key:"addImg",value:function(e){var i=this;e.forEach(function(e){var t=new Image;t.src=e,t.name=e,t.loaded=!1,i.imageList.push(t)})}},{key:"getImg",value:function(t){var i=void 0;return this.imageList.forEach(function(e){e.name==t&&(i=e)}),i}}]),e}(),r=function(e,t){var i=window.devicePixelRatio||1,n=null;return e.forEach(function(e){n=e.getContext("2d"),e.style.position=t.position,e.style.width=t.width+"px",e.style.height=t.height+"px",e.width=t.width*i,e.height=t.height*i,n.scale(i,i)}),e},_=function(e,t,i,n,s,a,r){if(0===s)return!1;var o=s,h=0;if(t+o<r&&n+o<r||r<t-o&&r<n-o||e+o<a&&i+o<a||a<e-o&&a<i-o)return!1;if(e===i)return Math.abs(a-e)<=o/2;var l=(h=(t-n)/(e-i))*a-r+(e*n-i*t)/(e-i);return l*l/(h*h+1)<=o/2*o/2},o=function(e,t){var i,n,s,a,r,o,h=this.moveX*this._.scale,l=this.moveY*this._.scale,c=e-h-(this.fixed?0:this._.transX),u=t-l-(this.fixed?0:this._.transY);switch(this.type){case"rectangle":case"group":return i=c,n=u,s=this.scaled_x,a=this.scaled_y,r=this.scaled_width,o=this.scaled_height,s<i&&i<s+r&&a<n&&n<a+o;case"arc":var d=this.scaled_x,f=this.scaled_y,v=Math.PI,g=this.startAngle<0?2*v+v/180*this.startAngle:v/180*this.startAngle,m=this.endAngle<0?2*v+v/180*this.endAngle:v/180*this.endAngle;return function(e,t,i,n,s){var a,r=Math.PI,o=void 0,h=void 0;isNaN(n)||isNaN(s)?h=!!(Math.sqrt(e*e+t*t)<=i):(0<=e&&0<=t?a=0===e?r/2:Math.atan(t/e):e<=0&&0<=t?a=0===e?r:r-Math.atan(t/Math.abs(e)):e<=0&&t<=0?a=0===e?r:Math.atan(Math.abs(t)/Math.abs(e))+r:0<=e&&t<=0&&(a=0===e?3*r/2:2*r-Math.atan(Math.abs(t)/e)),o=Math.sqrt(e*e+t*t),h=n<s?!!(n<=a&&a<=s&&o<=i):!!((0<=a&&a<=s||n<=a&&a<=2*r)&&o<=i));return h}(c-d,u-f,this.scaled_radius,g,m);case"polygon":return function(e,t,i){for(var n=!1,s=0,a=i.length-1;s<i.length;a=s++)i[s][1]>t!=i[a][1]>t&&e<(i[a][0]-i[s][0])*(t-i[s][1])/(i[a][1]-i[s][1])+i[s][0]&&(n=!n);return n}(c,u,this.scaled_matrix);case"line":for(var b=this.scaled_matrix,p=b.length,y=0;y<p;y++)if(0<y&&_(b[y-1][0],b[y-1][1],b[y][0],b[y][1],this.scaled_lineWidth,c,u))return!0;return!1}};var h=function(t){return function(e){return Math.pow(e,t)}},l=function(t){return function(e){return 1-Math.abs(Math.pow(e-1,t))}},t=function(t){return function(e){return e<.5?h(t)(2*e)/2:l(t)(2*e-1)/2+.5}},c=h(2),v=l(2),g=t(2),m=h(3),b=l(3),p=t(3),y=h(4),w=l(4),x=t(4),k=h(5),T=l(5),M=t(5),j=function(e){var t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375},I=function(e){return 1-j(1-e)},O=Object.freeze({linear:function(e){return e},quadIn:c,quadOut:v,quadInOut:g,cubicIn:m,cubicOut:b,cubicInOut:p,quartIn:y,quartOut:w,quartInOut:x,quintIn:k,quintOut:T,quintInOut:M,sineIn:function(e){return 1+Math.sin(Math.PI/2*e-Math.PI/2)},sineOut:function(e){return Math.sin(Math.PI/2*e)},sineInOut:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2},bounceOut:j,bounceIn:I,bounceInOut:function(e){return e<.5?.5*I(2*e):.5*j(2*e-1)+.5}}),P=function(){function u(e){d(this,u);var t=e.from,i=e.to,n=e.duration,s=e.delay,a=e.easing,r=e.onStart,o=e.onUpdate,h=e.onFinish;for(var l in t)void 0===i[l]&&(i[l]=t[l]);for(var c in i)void 0===t[c]&&(t[c]=i[c]);this.from=t,this.to=i,this.duration=n||500,this.delay=s||0,this.easing=a||"linear",this.onStart=r,this.onUpdate=o,this.onFinish=h,this.startTime=Date.now()+this.delay,this.started=!1,this.finished=!1,this.keys={}}return n(u,[{key:"update",value:function(){if(this.time=Date.now(),!(this.time<this.startTime))if(this.elapsed!==this.duration){for(var e in this.elapsed=this.time-this.startTime,this.elapsed=this.elapsed>this.duration?this.duration:this.elapsed,this.to)this.keys[e]=this.from[e]+(this.to[e]-this.from[e])*O[this.easing](this.elapsed/this.duration);this.started||(this.onStart&&this.onStart(this.keys),this.started=!0),this.onUpdate(this.keys)}else this.finished||(this.finished=!0,this.onFinish&&this.onFinish(this.keys))}}]),u}(),S=function(){function i(e,t){d(this,i),this._=t,this.commonData={color:e.color,x:e.x,scaled_x:e.x*t.scale,y:e.y,scaled_y:e.y*t.scale,width:e.width,scaled_width:e.width*t.scale,height:e.height,scaled_height:e.height*t.scale,moveX:0,scaled_moveX:0,moveY:0,scaled_moveY:0,boundingWidth:0,boundingHeight:0,zindex:0}}return n(i,[{key:"on",value:function(e,t){var i=this;if(!this.isBg){if(!e)throw"no eventTypes defined!";if(!t||"function"!=typeof t)throw"you need defined a callback!";this.events=this.events||[];var n=e.split(" "),s=this;return n.forEach(function(e){if(!~i._.eventTypes.indexOf(e))throw e+" is not in eventTypes!\n Please use event in "+i._.eventTypes;s.events.push({eventType:e,callback:t})}),this}}},{key:"isPointInner",value:function(e,t){return o.bind(this)(e,t)}},{key:"config",value:function(e){if("[object Object]"===Object.prototype.toString.call(e))return e.drag&&(this.enableDrag=e.drag),e.changeIndex&&(this.enableChangeIndex=e.changeIndex),e.fixed&&(this.fixed=e.fixed),e.bg&&(this.isBg=e.bg),e.cliping&&(this.cliping=e.cliping),this.zindex=e.zindex||0,this}},{key:"animateTo",value:function(e){var i=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.animating=!0;var t={},s=e,a={};for(var r in s)a[r]=this[r];for(var o in t.from=a,t.to=s,t.onUpdate=function(e){for(var t in s)i[t]=e[t];n.onUpdate&&n.onUpdate(e)},n)"onUpdate"!==o&&(t[o]=n[o]);t.onFinish=function(){i.animating=!1,n.onFinish&&n.onFinish(e)};var h=new P(t);return this._.animationList.push(h),this._.tick(),this}},{key:"drag",value:function(e){this.enableDrag=e}},{key:"changeIndex",value:function(e){this.enableChangeIndex=e}}]),i}();function A(e,t){var i=new S(e,t);return Object.assign({},i.commonData,{isDragging:!1,hasEnter:!1,hasDraggedIn:!1,on:i.on,animateTo:i.animateTo,isPointInner:i.isPointInner,config:i.config,_:i._,isShape:!0,parent:null,hide:e.hide,animating:!1,forceUpdate:!1,updated:!1,getBounding:function(){return e=this.scaled_matrix,t=this.scaled_lineWidth,i=t||0,n=e.map(function(e){return e[0]}),s=e.map(function(e){return e[1]}),a=f.getMin(n)-i,r=f.getMax(n)+i,o=f.getMin(s)-i,h=f.getMax(s)+i,{lt:[a,o],rt:[r,o],rb:[r,h],lb:[a,h],w:r-a,h:h-o};var e,t,i,n,s,a,r,o,h}})}
/*!
 * @PengJiyuan
 *
 * Two-dimensional coordinate system
 * Matrix transformation
 */var Y=Math.PI,X=Math.cos,D=Math.sin,E=Math.abs,C=function(e,t){var s=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[0,0],t=arguments[1],i=e[0],n=e[1],s=-Y/180*t;return[[X(s),-D(s),(1-X(s))*i+n*D(s)],[D(s),X(s),(1-X(s))*n-i*D(s)],[0,0,1]]}(e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:0),a=[];return t.forEach(function(e){var t=[e[0],e[1],1],i=s[0][0]*t[0]+s[0][1]*t[1]+s[0][2]*t[2],n=s[1][0]*t[0]+s[1][1]*t[1]+s[1][2]*t[2];a.push([E(i)<1e-7?0:i,E(n)<1e-7?0:n])}),a},F=function(t){for(var i=this,e=arguments.length,n=Array(1<e?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];n.forEach(function(e){"matrix"===e?i.scaled_matrix=i.matrix.map(function(e){return e.map(function(e){return e*t})}):i["scaled_"+e]=i[e]*t})},L=function(e,t,i,n,s){this.matrix=[[e,t],[e+i,t],[e+i,t+n],[e,t+n]],this.origin=[e+.5*i,t+.5*n],this.scaled_matrix=C(this.origin,this.matrix,s)},W="#555",q={tl:0,tr:0,bl:0,br:0};function R(e,t,i){if(e.cliping){var n=e.getBounding();e.cliping.column?t.rect(n.lt[0],n.lt[1],n.rt[0]-n.lt[0],e.boundingHeight*i):t.rect(n.lt[0],n.lt[1],e.boundingWidth*i,n.rb[1]-n.rt[1]),t.clip()}}var z={arc:function(e,i){return Object.assign({},A(e,i),{type:"arc",draw:function(){var e=i.canvas,t=i.scale;F.call(this,t,"x","y","width","height","moveX","moveY","radius"),e.save(),this.fixed&&e.translate(-i.transX,-i.transY),e.translate(this.scaled_moveX,this.scaled_moveY),e.translate(this.scaled_x,this.scaled_y),this.hide||(e.beginPath(),isNaN(this.startAngle)||isNaN(this.endAngle)?e.arc(0,0,this.scaled_radius,0,2*Math.PI):(e.arc(0,0,this.scaled_radius,Math.PI/180*this.startAngle,Math.PI/180*this.endAngle,!1),e.save(),e.rotate(Math.PI/180*this.endAngle),e.moveTo(this.scaled_radius,0),e.lineTo(0,0),e.restore(),e.rotate(Math.PI/180*this.startAngle),e.lineTo(this.scaled_radius,0)),"fill"===this.style?(e.fillStyle=this.color,e.fill()):(e.strokeStyle=this.color,e.stroke()),e.closePath()),e.restore()},style:e.style,startAngle:e.startAngle,endAngle:e.endAngle,radius:e.radius,scaled_radius:e.radius*i.scale})},image:function(n,s){n.src&&!~s.images.indexOf(n.src)&&s.images.push(n.src);return Object.assign({},A(n,s),{type:"rectangle",draw:function(){var e=s.canvas,t=n.src,i=s.scale;F.call(this,i,"x","y","width","height","moveX","moveY"),e.save(),e.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&e.translate(-s.transX,-s.transY);try{this.hide||(this.sliceWidth&&this.sliceHeight?e.drawImage(s.loader.getImg(t),this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight,this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height):e.drawImage(s.loader.getImg(t),this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height))}catch(e){throw new Error("The picture is not loaded successfully, please check the picture url : "+t)}e.restore()},sliceWidth:n.sliceWidth,sliceHeight:n.sliceHeight,sliceX:n.sliceX,sliceY:n.sliceY})},line:function(l,c){return Object.assign({},A(l,c),{type:"line",draw:function(){var i=c.canvas,e=l.lineCap,t=l.lineJoin,n=l.smooth,s=c.scale;if(this.matrix&&this.matrix.length<2)throw"The line needs at least two points";this.scaled_matrix=this.matrix.map(function(e){return e.map(function(e){return e*s})}),F.call(this,s,"moveX","moveY","lineWidth");var a=this.scaled_matrix;if(i.save(),i.translate(this.scaled_moveX,this.scaled_moveX),this.fixed&&i.translate(-c.transX,-c.transY),R(this,i,s),!this.hide){if(i.beginPath(),i.lineWidth=this.scaled_lineWidth,i.strokeStyle=this.color,i.lineDashOffset=this.offset,this.dash&&f.isArr(this.dash)&&i.setLineDash(this.dash),e&&(i.lineCap=e),t&&(i.lineJoin=t),n)for(var r=function(e,t,i,n){var s=void 0,a=void 0,r=void 0,o=void 0;if(i&&n||(n=i=.25),t<1?(s=e[0][0]+(e[1][0]-e[0][0])*i,a=e[0][1]+(e[1][1]-e[0][1])*i):(s=e[t][0]+(e[t+1][0]-e[t-1][0])*i,a=e[t][1]+(e[t+1][1]-e[t-1][1])*i),t>e.length-3){var h=e.length-1;r=e[h][0]-(e[h][0]-e[h-1][0])*n,o=e[h][1]-(e[h][1]-e[h-1][1])*n}else r=e[t+1][0]-(e[t+2][0]-e[t][0])*n,o=e[t+1][1]-(e[t+2][1]-e[t][1])*n;return{pA:{x:s,y:a},pB:{x:r,y:o}}},o=0;o<a.length;o++)if(0===o)i.moveTo(a[o][0],a[o][1]);else{var h=r(a,o-1);i.bezierCurveTo(h.pA.x,h.pA.y,h.pB.x,h.pB.y,a[o].x,a[o].y)}else a.forEach(function(e,t){0===t?i.moveTo(e[0],e[1]):i.lineTo(e[0],e[1])});i.stroke(),i.closePath()}i.restore()},totalLength:void 0,lineWidth:l.lineWidth||1,dash:l.dash,offset:l.offset||0,color:l.color||W,matrix:l.matrix,scaled_matrix:l.matrix})},rectangle:function(e,s){return Object.assign({},A(e,s),{type:"polygon",draw:function(){var e=s.canvas,t=s.scale;if(F.call(this,t,"x","y","width","height","moveX","moveY"),L.call(this,this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height,this.rotate),e.save(),e.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&e.translate(-s.transX,-s.transY),R(this,e,t),!this.hide){e.beginPath();var i=this.scaled_matrix,n=this.radius;e.moveTo(i[0][0]+n.tl*t,i[0][1]),e.lineTo(i[1][0]-n.tr*t,i[0][1]),e.quadraticCurveTo(i[1][0],i[0][1],i[1][0],i[0][1]+n.tr*t),e.lineTo(i[1][0],i[2][1]-n.br*t),e.quadraticCurveTo(i[1][0],i[2][1],i[1][0]-n.br*t,i[2][1]),e.lineTo(i[0][0]+n.bl*t,i[2][1]),e.quadraticCurveTo(i[0][0],i[2][1],i[0][0],i[2][1]-n.bl*t),e.lineTo(i[0][0],i[0][1]+n.tl*t),e.quadraticCurveTo(i[0][0],i[0][1],i[0][0]+n.tl*t,i[0][1]),"stroke"!==this.style?(e.fillStyle=this.color||W,e.fill()):(e.strokeStyle=this.color||W,e.lineWidth=this.lineWidth,e.stroke()),e.closePath()}e.restore()},rotate:e.radius?0:e.rotate,radius:e.radius||q})},text:function(h,l){h.background&&h.background.img&&!~l.images.indexOf(h.background.img)&&l.images.push(h.background.img);return Object.assign({},A(h,l),{type:"rectangle",draw:function(){var e=l.canvas,t=l.scale,i=h.center,n=h.fontFamily||"arial,sans-serif",s=h.fontSize||14,a="normal "+(h.fontWeight||400)+" "+s*t+"px "+n;F.call(this,t,"x","y","width","height","moveX","moveY","paddingTop","paddingLeft");var r=void 0,o=void 0;e.save(),e.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&e.translate(-l.transX,-l.transY),this.hide||(this.background&&(this.background.color?(e.save(),e.fillStyle=this.background.color,e.fillRect(this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height),e.restore()):this.background.img&&e.drawImage(l.loader.getImg(this.background.img),this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height)),e.font=a,e.textBaseline="top",r=e.measureText(this.text).width,o=function(e,t,i){var n=e.measureText(t).width,s=e.measureText("...").width;if(n<=i||n<=s)return t;for(var a=t.length;i-s<=n&&0<a--;)t=t.substring(0,a),n=e.measureText(t).width;return t+"..."}(e,this.text,this.scaled_width-8),"stroke"===this.style?(e.strokeStyle=this.color,i?r<this.scaled_width-8&&e.strokeText(o,this.scaled_x+this.scaled_paddingLeft+(this.scaled_width-r-8)/2,this.scaled_y+this.scaled_paddingTop):e.strokeText(o,this.scaled_x+this.scaled_paddingLeft,this.scaled_y+this.scaled_paddingTop)):(e.fillStyle=this.color,i?r<this.scaled_width-8&&e.fillText(o,this.scaled_x+this.scaled_paddingLeft+(this.scaled_width-r-8)/2,this.scaled_y+this.scaled_paddingTop):e.fillText(o,this.scaled_x+this.scaled_paddingLeft,this.scaled_y+this.scaled_paddingTop))),e.restore()},color:h.color||W,background:h.background,text:h.text||"no text",style:h.style||"fill",paddingTop:h.paddingTop||0,paddingLeft:h.paddingLeft||0})},polygon:function(e,n){return Object.assign({},A(e,n),{type:"polygon",draw:function(){var i=n.canvas,e=n.scale;F.call(this,e,"moveX","moveY","matrix","lineWidth");var t=this.scaled_matrix;i.save(),i.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&i.translate(-n.transX,-n.transY),this.hide||(i.beginPath(),R(this,i,e),i.closePath(),i.beginPath(),t.forEach(function(e,t){0===t?i.moveTo(e[0],e[1]):i.lineTo(e[0],e[1])}),i.lineTo(t[0][0],t[0][1]),"fill"===this.style?(i.fillStyle=this.color,i.fill()):(i.strokeStyle=this.color,i.lineWidth=this.scaled_lineWidth,i.stroke()),i.closePath()),i.restore()},style:e.style||"fill",color:e.color||W,lineWidth:e.lineWidth||1,matrix:e.matrix,scaled_matrix:e.matrix})}},B=Object.freeze({display:A,DefineScale:F,DefineMatrix:L}),H=function(){function t(e){d(this,t),this.version=i,this.objects=[],this.groupRecords=0,this.transX=0,this.transY=0,this.deviceScale=e.deviceScale||1,this.minDeviceScale=e.minDeviceScale||.5*this.deviceScale,this.maxDeviceScale=e.maxDeviceScale||4*this.deviceScale,this.scale=this.deviceScale,this.loader=null,this.prepareImage=e.prepareImage,this.pointerInnerArray=[],this.globalMousedown=void 0,this.globalMousemove=void 0,this.isDragging=!1,this.Tween=P,this.animationList=[],this.animationId=null,this.animating=!1,this.fpsFunc=null,this.fps=0,this.fpsCacheTime=0,this.eventTypes=["mousedown","mouseup","mouseenter","mouseleave","mousemove","drag","dragend","dragin","dragout","drop"],this._event=new s(this),this.color=new a,this.element=e.element,this.canvas=this.element.getContext("2d"),this.width=e.width,this.height=e.height,r([this.element],{width:this.width,height:this.height,position:e.position||"relative"}),this.ext=B,this.clip=R,this.enableGlobalTranslate=e.enableGlobalTranslate||!1,this.enableGlobalScale=e.enableGlobalScale||!1,this.images=e.images||[],this.utils=f,this.shapes=z}return n(t,[{key:"init",value:function(){var e=this;Object.keys(this.shapes).forEach(function(t){e[t]=function(e){return this.shapes[t](e,this)}}),this.group=function(e){return t=e,c=this,Object.assign({},A(t,c),{type:"group",draw:function(){var e=c.canvas,t=c.scale;F.call(this,t,"x","y","width","height","moveX","moveY"),L.call(this,this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height),e.save(),e.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&e.translate(-c.transX,-c.transY),e.beginPath();var i=this.scaled_matrix,n=this.radius;if(e.moveTo(i[0][0]+n.tl*t,i[0][1]),e.lineTo(i[1][0]-n.tr*t,i[0][1]),e.quadraticCurveTo(i[1][0],i[0][1],i[1][0],i[0][1]+n.tr*t),e.lineTo(i[1][0],i[2][1]-n.br*t),e.quadraticCurveTo(i[1][0],i[2][1],i[1][0]-n.br*t,i[2][1]),e.lineTo(i[0][0]+n.bl*t,i[2][1]),e.quadraticCurveTo(i[0][0],i[2][1],i[0][0],i[2][1]-n.bl*t),e.lineTo(i[0][0],i[0][1]+n.tl*t),e.quadraticCurveTo(i[0][0],i[0][1],i[0][0]+n.tl*t,i[0][1]),f.isObj(this.background)){var s=this.background;s.color&&(e.fillStyle=s.color||W,e.fill())}else if(f.isObj(this.border)){var a=this.border;e.strokeStyle=a.color||W,e.lineWidth=a.lineWidth||1,e.stroke()}e.closePath();var r=this.title;if(r&&"object"===(void 0===r?"undefined":u(r))){var o=r.fontSize||14,h=r.paddingTop||4,l=r.paddingLeft||2;e.fillStyle=r.color||"#000",e.textBaseline="top",e.font="normal 400 "+o*t+"px "+(r.fontFamily||"arial,sans-serif"),e.fillText(r.text,this.scaled_x+l*t,this.scaled_y+h*t)}e.restore()},background:t.background,border:t.border,radius:t.radius||q,title:t.title,children:[],add:function(e){var i=this;if(!f.isArr(e))throw"The parameter must be an array";if(!~this._.objects.indexOf(this))throw"before add, please addChild the parent!";e.forEach(function(e){var t;e.isShape&&((e.parent=i)._.groupRecords+=1e-10,e.zindex=i.zindex+i._.groupRecords,(t=e).updated&&!t.forceUpdate||(t.updated=!0,t.moveX=t.parent.x+t.parent.moveX,t.moveY=t.parent.y+t.parent.moveY,t.enableChangeIndex=!1,t.fixed=!1,t.drag=!1),i.enableDrag=!1,i.children.push(e))}),f.insertArray(this._.objects,this._.objects.indexOf(this)+1,0,e),this._.objects.sort(function(e,t){return e.zindex-t.zindex}),this._._objects=f.reverse(this._.objects)},remove:function(e){var i=this,t=e;"function"==typeof e?t=this.children.filter(e):f.isArr(e)||(t=[e]),t.forEach(function(t){var e=i.children.indexOf(t);~e&&(t.parent=null,i.children.splice(e,1),i._.objects=i._.objects.filter(function(e){return e!==t}),i._._objects=f.reverse(i._.objects))})},updateAllChildsPosition:function(){this.children.forEach(function(e){e.moveX=e.parent.x+e.parent.moveX,e.moveY=e.parent.y+e.parent.moveY})}});var t,c}}},{key:"extend",value:function(e){for(var t in e)this.shapes[t]=e[t]}},{key:"addChild",value:function(e){f.isArr(e)?this.objects=this.objects.concat(e):this.objects.push(e),this.objects.sort(function(e,t){return e.zindex-t.zindex}),this._objects=f.reverse(this.objects)}},{key:"removeChild",value:function(t){f.isArr(t)?this.objects=this.objects.filter(function(e){return!~t.indexOf(e)}):this.objects=this.objects.filter(function(e){return e!==t}),this._objects=f.reverse(this.objects)}},{key:"removeFirstChild",value:function(){this.objects.pop(),this._objects=f.reverse(this.objects)}},{key:"removeLastChild",value:function(){this.objects.shift(),this._objects=f.reverse(this.objects)}},{key:"removeAllChilds",value:function(){this.objects=[],this._objects=[]}},{key:"imgReady",value:function(){this.loader=new e,this.loader.addImg(this.images)}},{key:"show",value:function(){var e=this,t=this;this.prepareImage?(this.imgReady(),this.loader.ready(function(){"function"==typeof e.prepareImage&&e.prepareImage(),t.draw(),t._event.triggerEvents()})):(this.draw(),this._event.triggerEvents())}},{key:"draw",value:function(){this.objects.forEach(function(e){e.draw()})}},{key:"redraw",value:function(){this.clear(),this.canvas.save(),this.canvas.translate(this.transX,this.transY),this.draw(),this.canvas.restore()}},{key:"clear",value:function(){this.canvas.clearRect(0,0,this.width,this.height)}},{key:"tick",value:function(){var i=this;return 0<this.animationList.length&&!this.animating&&(this.animating=!0,this.animationId=Date.now(),function e(){if(i.fpsFunc){var t=Date.now();1e3<=t-i.fpsCacheTime?(i.fpsFunc(i.fps),i.fps=0,i.fpsCacheTime=t):i.fps++}i.animationList.forEach(function(e,t){e.finished?i.animationList.splice(t--,1):e.update?e.update():e()}),i.redraw(),0===i.animationList.length&&i.animating?(i.animating=!1,cancelAnimationFrame(i[i.animationId])):i[i.animationId]=requestAnimationFrame(e)}()),this.animationId}},{key:"fpsOn",value:function(e){this.fpsFunc=e,this.fpsCacheTime=Date.now()}},{key:"fpsOff",value:function(){this.fpsFunc=null,this.fps=0}},{key:"animate",value:function(e){this._event.triggerEvents(),this.animationList.push(e),this.tick()}},{key:"clearAnimation",value:function(){this.animationList=[],this.animating=!1,cancelAnimationFrame(this[this.animationId])}},{key:"getVersion",value:function(){return this.version}},{key:"mousedown",value:function(e){this.globalMousedown=e}},{key:"mousemove",value:function(e){this.globalMousemove=e}},{key:"resize",value:function(e){var t=this,i=function(){t.width=e.width(),t.height=e.height(),r([t.element],{width:t.width,height:t.height,position:"absolute"}),t.redraw()};window.onresize||f.bind(window,"resize",function(){e.resize?e.resize(i):i()})}}]),t}();return function(e){return new H(e)}});
