/*!
 * omg.js v3.0.0-beta.3
 * Author: PengJiyuan
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.omg=e()}(this,function(){"use strict";!function(){for(var t=["ms","moz","webkit","o"],e=0,i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=(new Date).getTime(),s=Math.max(0,16-(i-e)),n=window.setTimeout(function(){t(i+s)},s);return e=i+s,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){var i=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(t),n=1;n<arguments.length;n++){var a=i[n];if(null!=a)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(s[o]=a[o])}return s},writable:!0,configurable:!0})}();var t={getPos:function(t){var e=t||event,i=[e.pageX,e.pageY];return{x:i[0],y:i[1]}},bind:function(t,e,i){return window.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i,t},unbind:function(t,e,i){window.removeEventListener?t.removeEventListener(e,i,!1):window.detachEvent?t.detachEvent(e,i):t["on"+e]=""},reverse:function(t){for(var e=[t.length,[]],i=e[0],s=e[1],n=0;n<i;n++)s[n]=t[i-n-1];return s},calculateCoord:function(t,e){var i,s,n,a,o,r=[Math.abs(t),Math.abs(e)],h=r[0],c=r[1];if(n=h>=c?h:c,o=n.toString().length,1===(a=n<1?this.formatFloat(n*Math.pow(10,o-2),1):n/Math.pow(10,o-1))&&o>1)a=10,o--;else if(a>10){var l=a.toString().length;a/=Math.pow(10,l-1),o=o-l+1}var d=[[1,.2],[1.2,.2],[1.4,.2],[1.5,.3],[1.8,.3],[2,.4],[2.5,.5],[3,.5],[3.5,.5],[4,.5],[5,1],[6,1],[7,1],[8,1],[10,2]];return d.forEach(function(t,e){(0===e?0:d[e-1][0])<a&&a<=t[0]&&(i=t[1],s=t[0])}),{gap:n<1?i/Math.pow(10,o-2):i*Math.pow(10,o-1),max:n<1?s/Math.pow(10,o-2):s*Math.pow(10,o-1)}},formatFloat:function(t){var e=Math.pow(10,10);return parseInt(t*e,10)/e},getMaxMin:function(t,e,i){var s,n,a=[],o=[];return e.forEach(function(e){var s=[];e.data.forEach(function(e){t?s.push(e[0]):i.data&&i.data.length>0?s.push(e):s.push(e[1])}),a.push(Math.max.apply(null,s)),o.push(Math.min.apply(null,s))}),s=Math.max.apply(null,a),n=Math.min.apply(null,o),{max:s,min:n}},isArr:function(t){return"[object Array]"===Object.prototype.toString.call(t)}},e=function(t){this._=t,this.triggeredMouseDown=!1,this.triggeredMouseMove=!1};e.prototype.getPos=function(t){var e=t||event,i=[e.pageX-this._.element.offsetLeft,e.pageY-this._.element.offsetTop];return{x:i[0],y:i[1]}},e.prototype.triggerEvents=function(){if(this._.objects.some(function(e){return e.events&&t.isArr(e.events)||e.enableDrag})||this._.enableGlobalTranslate||this._.enableGlobalScale){var e=this._.objects.some(function(t){return t.events&&t.events.some(function(t){return"mouseenter"===t.eventType||"mousemove"===t.eventType||"drag"===t.eventType||"dragin"===t.eventType||"dragout"===t.eventType||"drop"===t.eventType})})||this._.globalMousemove;e&&!this.triggeredMouseMove&&(this.bindMouseMove(),this.triggeredMouseMove=!0),!e&&this.triggeredMouseMove&&(this.unBindMouseMove(),this.triggeredMouseMove=!1),this.triggeredMouseDown||(t.bind(this._.element,"mousedown",this.mouseDown.bind(this)),this.triggeredMouseDown=!0),this._.enableGlobalScale?this.bindMouseWheel():this.unBindMouseWheel()}},e.prototype.bindMouseWheel=function(){t.bind(this._.element,"wheel",this.mouseWheel.bind(this))},e.prototype.unBindMouseWheel=function(){t.unbind(this._.element,"wheel",this.mouseWheel.bind(this))},e.prototype.mouseWheel=function(t){t.deltaY&&t.deltaY>0?this._.scale=this._.scale-.01>=this._.minDeviceScale?this._.scale-.01:this._.minDeviceScale:t.deltaY&&t.deltaY<0&&(this._.scale=this._.scale+.01<=this._.maxDeviceScale?this._.scale+.01:this._.maxDeviceScale),this._.redraw()},e.prototype.bindMouseMove=function(){t.bind(this._.element,"mousemove",this.mouseEnterOrMove.bind(this))},e.prototype.unBindMouseMove=function(){t.unbind(this._.element,"mousemove",this.mouseEnterOrMove.bind(this))},e.prototype.mouseEnterOrMove=function(t){var e,i=this.getPos(t).x,s=this.getPos(t).y;this._.globalMousemove&&this._.globalMousemove(t),e=this._.objects.some(function(t){return t.isDragging});var n=this._._objects.filter(function(t){return t.isPointInner(i,s)});if(e){n&&n.length>1&&n[1].events&&n[1].events.forEach(function(t){"dragin"!==t.eventType||n[1].hasDraggedIn||(n[1].hasDraggedIn=!0,t.callback&&t.callback(n[1]))});this._._objects.some(function(t){return t.hasDraggedIn&&(!t.isPointInner(i,s)||n[1]!==t)&&function(t){t.hasDraggedIn&&t.events.forEach(function(t){"dragout"===t.eventType&&t.callback&&t.callback(n[1])}),t.hasDraggedIn=!1}(t)})}else{n&&n.length>0&&n[0].events&&n[0].events.forEach(function(t){"mouseenter"!==t.eventType||n[0].hasEnter?"mousemove"===t.eventType&&t.callback&&t.callback(n[0]):(n[0].hasEnter=!0,t.callback&&t.callback(n[0]))});this._._objects.some(function(t){return t.hasEnter&&(!t.isPointInner(i,s)||n[0]!==t)&&function(t){t.hasEnter&&t.events.forEach(function(e){"mouseleave"===e.eventType&&e.callback&&e.callback(t)}),t.hasEnter=!1}(t)})}},e.prototype.mouseDown=function(e){var i,s,n,a,o,r=this;this._.globalMousedown&&this._.globalMousedown(e);var h=this._.objects.some(function(t){return t.enableDrag}),c=this.getPos(e).x,l=this.getPos(e).y;r.cacheX=c,r.cacheY=l;var d=this._._objects.filter(function(t){return t.isPointInner(c,l)&&!t.isBg});if(d&&d.length>0&&(d[0].enableChangeIndex&&r.changeOrder(d[0]),d[0].events&&d[0].events.some(function(t){return"mousedown"===t.eventType&&t.callback&&t.callback(d[0])})),h){i=r._._objects.filter(function(t){return t.isPointInner(c,l)&&!t.isBg}),s=i.length>0&&i[0].events&&i[0].events.some(function(t){return"drag"===t.eventType&&(a=t.callback),"drag"===t.eventType}),n=i.length>0&&i[0].events&&i[0].events.some(function(t){return"dragend"===t.eventType&&(o=t.callback),"dragend"===t.eventType});var u=function(t){var e=r.getPos(t).x,n=r.getPos(t).y;i[0].originMoveX=i[0].originMoveX+e-r.cacheX,i[0].originMoveY=i[0].originMoveY+n-r.cacheY,i[0].moveX=i[0].moveX+e-r.cacheX,i[0].moveY=i[0].moveY+n-r.cacheY,s&&a(d[0]),r._.redraw(),r.cacheX=e,r.cacheY=n,i[0].isDragging=!0},f=function(e){var s=r.getPos(e).x,a=r.getPos(e).y,h=r._._objects.filter(function(t){return t.isPointInner(s,a)});if(h&&h.length>1&&h[1].hasDraggedIn){h[1].hasDraggedIn=!1;!h[1].events.some(function(t){return"drop"===t.eventType&&t.callback&&t.callback(h[1],h[0])})&&h[1].events.some(function(t){return"dragout"===t.eventType&&t.callback&&t.callback(h[1])})}n&&o(d[0]),t.unbind(document,"mousemove",u),t.unbind(document,"mouseup",f),i[0].isDragging=!1};i&&i.length>0&&i[0].enableDrag&&(t.bind(document,"mousemove",u),t.bind(document,"mouseup",f))}if(this._.enableGlobalTranslate&&!(i&&i.length>0)){var g=function(t){var e=r.getPos(t).x,i=r.getPos(t).y;r._.transX=r._.transX+e-r.cacheX,r._.transY=r._.transY+i-r.cacheY,r._.redraw(),r.cacheX=e,r.cacheY=i},v=function(){t.unbind(document,"mousemove",g),t.unbind(document,"mouseup",v)};t.bind(document,"mousemove",g),t.bind(document,"mouseup",v)}},e.prototype.changeOrder=function(e){var i=this._.objects.indexOf(e),s=this._.objects[i];this._.objects.splice(i,1),this._.objects.push(s),this._._objects=t.reverse(this._.objects),this._.redraw()};var i=function(){};i.prototype.hexToRGB=function(t){var e=[];return 3===(t=t.substr(1)).length&&(t=t.replace(/(.)/g,"$1$1")),t.replace(/../g,function(t){e.push(parseInt(t,16))}),{r:e[0],g:e[1],b:e[2],rgb:"rgb("+e.join(",")+")"}},i.prototype.rgbToHSL=function(t,e,i){t/=255,e/=255,i/=255;var s,n,a=Math.max(t,e,i),o=Math.min(t,e,i),r=(a+o)/2;if(a==o)s=n=0;else{var h=a-o;switch(n=r>.5?h/(2-a-o):h/(a+o),a){case t:s=(e-i)/h+(e<i?6:0);break;case e:s=(i-t)/h+2;break;case i:s=(t-e)/h+4}s/=6}return{h:s,s:n,l:r,hsl:"hsl("+360*s+", "+100*n+"%, "+100*r+"%)"}},i.prototype.hslToRGB=function(){},i.prototype.lighten=function(t,e){var i,s,n,a,o,r;if(t&&e&&/^[0-9]{1,2}%$/.test(e))return this.isRgba(t)?(o=this.getRgba(t),r=+o.a-+e.slice(0,-1)/100,"rgba("+o.r+", "+o.g+", "+o.b+", "+r+")"):(i=this.getHsl(t),s=+i.h,n=+i.s,a=100*+i.l+ +e.slice(0,-1),"hsl("+360*s+", "+100*n+"%, "+a+"%)")},i.prototype.darken=function(t,e){var i,s,n,a,o,r;if(t&&e&&/^[0-9]{1,2}%$/.test(e))return this.isRgba(t)?(o=this.getRgba(t),r=+o.a+ +e.slice(0,-1)/100,"rgba("+o.r+", "+o.g+", "+o.b+", "+r+")"):(i=this.getHsl(t),s=+i.h,n=+i.s,a=100*+i.l-+e.slice(0,-1),"hsl("+360*s+", "+100*n+"%, "+a+"%)")},i.prototype.isHex=function(t){return/^#[a-fA-F0-9]{3}$|#[a-fA-F0-9]{6}$/.test(t)},i.prototype.isRgb=function(t){return/^rgb\((\s*[0-5]{0,3}\s*,?){3}\)$/.test(t)},i.prototype.isRgba=function(t){return/^rgba\((\s*[0-5]{0,3}\s*,?){3}[0-9.\s]*\)$/.test(t)},i.prototype.getRgb=function(t){var e,i,s,n;if(this.isHex(t)){var a;i=(a=[(e=this.hexToRGB(t)).r,e.g,e.b])[0],s=a[1],n=a[2]}else if(this.isRgb(t)){var o;i=(o=[(e=t.slice(4,-1).split(","))[0],e[1],e[2]])[0],s=o[1],n=o[2]}return{r:i,g:s,b:n}},i.prototype.getRgba=function(t){var e,i,s,n,a,o;return o=[(e=t.slice(5,-1).split(","))[0],e[1],e[2],e[3]],i=o[0],s=o[1],n=o[2],a=o[3],{r:i,g:s,b:n,a:a}},i.prototype.getHsl=function(t){var e,i,s,n,a,o,r,h,c;s=(c=[(i=this.getRgb(t)).r,i.g,i.b])[0],n=c[1],a=c[2];var l;return l=[(e=this.rgbToHSL(s,n,a)).h,e.s,e.l],o=l[0],r=l[1],h=l[2],{h:o,s:r,l:h}};var s=function(){this.imageList=[],this.loadNum=0};s.prototype.ready=function(t){var e=this;this.imageList.forEach(function(t){e.loadImg(t)});var i=setInterval(function(){e.loadNum===e.imageList.length&&(clearInterval(i),t&&t())},50)},s.prototype.loadImg=function(t){var e=this,i=setInterval(function(){!0===t.complete&&(e.loadNum++,clearInterval(i))},50)},s.prototype.addImg=function(t){var e=this;t.forEach(function(t){var i=new Image;i.src=t,i.name=t,i.loaded=!1,e.imageList.push(i)})},s.prototype.getImg=function(t){var e;return this.imageList.forEach(function(i){i.name==t&&(e=i)}),e};var n=function(t){return function(e){return Math.pow(e,t)}},a=function(t){return function(e){return 1-Math.abs(Math.pow(e-1,t))}},o=function(t){return function(e){return e<.5?n(t)(2*e)/2:a(t)(2*e-1)/2+.5}},r=n(2),h=a(2),c=o(2),l=n(3),d=a(3),u=o(3),f=n(4),g=a(4),v=o(4),m=n(5),p=a(5),b=o(5),_=function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?(t-=1.5/i,e*t*t+.75):t<2.5/i?(t-=2.25/i,e*t*t+.9375):(t-=2.625/i,e*t*t+.984375)},y=function(t){return 1-_(1-t)},w=Object.freeze({linear:function(t){return t},quadIn:r,quadOut:h,quadInOut:c,cubicIn:l,cubicOut:d,cubicInOut:u,quartIn:f,quartOut:g,quartInOut:v,quintIn:m,quintOut:p,quintInOut:b,sineIn:function(t){return 1+Math.sin(Math.PI/2*t-Math.PI/2)},sineOut:function(t){return Math.sin(Math.PI/2*t)},sineInOut:function(t){return(1+Math.sin(Math.PI*t-Math.PI/2))/2},bounceOut:_,bounceIn:y,bounceInOut:function(t){return t<.5?.5*y(2*t):.5*_(2*t-1)+.5}}),x=function(t){var e=t.from,i=t.to,s=t.duration,n=t.delay,a=t.easing,o=t.onStart,r=t.onUpdate,h=t.onFinish;for(var c in e)void 0===i[c]&&(i[c]=e[c]);for(var l in i)void 0===e[l]&&(e[l]=i[l]);this.from=e,this.to=i,this.duration=s||500,this.delay=n||0,this.easing=a||"linear",this.onStart=o,this.onUpdate=r,this.onFinish=h,this.startTime=Date.now()+this.delay,this.started=!1,this.finished=!1,this.keys={}};x.prototype.update=function(){if(this.time=Date.now(),!(this.time<this.startTime))if(this.elapsed!==this.duration){this.elapsed=this.time-this.startTime,this.elapsed=this.elapsed>this.duration?this.duration:this.elapsed;for(var t in this.to)this.keys[t]=this.from[t]+(this.to[t]-this.from[t])*w[this.easing](this.elapsed/this.duration);this.started||(this.onStart&&this.onStart(this.keys),this.started=!0),this.onUpdate(this.keys)}else this.finished||(this.finished=!0,this.onFinish&&this.onFinish(this.keys))};var M=function(t,e){this._=e,this.commonData={color:t.color,x:t.x,scaled_x:t.x*e.scale,y:t.y,scaled_y:t.y*e.scale,width:t.width,scaled_width:t.width*e.scale,height:t.height,scaled_height:t.height*e.scale,moveX:0,scaled_moveX:0,moveY:0,scaled_moveY:0,zindex:0}};M.prototype.on=function(t,e){var i=this;if(!this.isBg){if(!t)throw"no eventTypes defined!";if(!e||"function"!=typeof e)throw"you need defined a callback!";this.events=this.events||[];var s=this;return t.split(" ").forEach(function(t){~i._.eventTypes.indexOf(t)?s.events.push({eventType:t,callback:e}):console.error(t+" is not in eventTypes!")}),this}},M.prototype.isPointInner=function(t,e){return function(t,e){var i=this.moveX*this._.scale,s=this.moveY*this._.scale,n=this.fixed?0:this._.transX,a=this.fixed?0:this._.transY,o=t>this.scaled_x+i+n,r=t<this.scaled_x+this.scaled_width+i+n,h=e>this.scaled_y+s+a,c=e<this.scaled_y+this.scaled_height+s+a;switch(this.type){case"rectangle":return!!(o&&r&&h&&c);case"arc":var l,d,u=this.scaled_x,f=this.scaled_y,g=Math.PI,v=this.startAngle<0?2*g+g/180*this.startAngle:g/180*this.startAngle,m=this.endAngle<0?2*g+g/180*this.endAngle:g/180*this.endAngle,p=this.scaled_radius,b=t-u-i-n,_=e-f-s-a;if(isNaN(v)||isNaN(m))l=!!(Math.sqrt(b*b+_*_)<=p);else{var y;b>=0&&_>=0?y=0===b?g/2:Math.atan(_/b):b<=0&&_>=0?y=0===b?g:g-Math.atan(_/Math.abs(b)):b<=0&&_<=0?y=0===b?g:Math.atan(Math.abs(_)/Math.abs(b))+g:b>=0&&_<=0&&(y=0===b?3*g/2:2*g-Math.atan(Math.abs(_)/b)),d=Math.sqrt(b*b+_*_),l=v<m?!!(y>=v&&y<=m&&d<=p):!!((y>=0&&y<=m||y>=v&&y<=2*g)&&d<=p)}return l;case"polygon":for(var w=this.scaled_matrix,x=t-i-n,M=e-s-a,T=!1,I=0,j=w.length-1;I<w.length;j=I++)w[I][1]>M!=w[j][1]>M&&x<(w[j][0]-w[I][0])*(M-w[I][1])/(w[j][1]-w[I][1])+w[I][0]&&(T=!T);return T}}.bind(this)(t,e)},M.prototype.config=function(t){if("[object Object]"===Object.prototype.toString.call(t))return t.drag&&(this.enableDrag=t.drag),t.changeIndex&&(this.enableChangeIndex=t.changeIndex),t.fixed&&(this.fixed=t.fixed),t.bg&&(this.isBg=t.bg),this.zindex=t.zindex||0,this},M.prototype.animateTo=function(t,e){var i=this;void 0===e&&(e={});var s={},n=t,a={};for(var o in n)a[o]=i[o];s.from=a,s.to=n,s.onUpdate=function(t){e.onUpdate&&e.onUpdate(t);for(var s in n)i[s]=t[s]};for(var r in e)"onUpdate"!==r&&(s[r]=e[r]);var h=new x(s);return this._.animationList.push(h),this._.tick(),this},M.prototype.drag=function(t){this.enableDrag=t},M.prototype.changeIndex=function(t){this.enableChangeIndex=t};var T=function(t,e){var i=new M(t,e);return Object.assign({},i.commonData,{isDragging:!1,hasEnter:!1,hasDraggedIn:!1,on:i.on,animateTo:i.animateTo,isPointInner:i.isPointInner,config:i.config,drag:i.drag,changeIndex:i.changeIndex,_:i._})},I={arc:function(t,e){return Object.assign({},T(t,e),{type:"arc",draw:function(){var t=e.canvas,i=e.scale;this.scaled_x=this.x*i,this.scaled_y=this.y*i,this.scaled_width=this.width*i,this.scaled_height=this.height*i,this.scaled_radius=this.radius*i,this.scaled_moveX=this.moveX*i,this.scaled_moveY=this.moveY*i,t.save(),this.fixed&&t.translate(-e.transX,-e.transY),t.translate(this.scaled_moveX,this.scaled_moveY),t.translate(this.scaled_x,this.scaled_y),t.beginPath(),isNaN(this.startAngle)||isNaN(this.endAngle)?t.arc(0,0,this.scaled_radius,0,2*Math.PI):(t.arc(0,0,this.scaled_radius,Math.PI/180*this.startAngle,Math.PI/180*this.endAngle,!1),t.save(),t.rotate(Math.PI/180*this.endAngle),t.moveTo(this.scaled_radius,0),t.lineTo(0,0),t.restore(),t.rotate(Math.PI/180*this.startAngle),t.lineTo(this.scaled_radius,0)),"fill"===this.style?(t.fillStyle=this.color,t.fill()):(t.strokeStyle=this.color,t.stroke()),t.closePath(),t.restore()},style:t.style,startAngle:t.startAngle,endAngle:t.endAngle,radius:t.radius,scaled_radius:t.radius*e.scale})},image:function(t,e){t.src&&!~e.images.indexOf(t.src)&&e.images.push(t.src);return Object.assign({},T(t,e),{type:"rectangle",draw:function(){var i=e.canvas,s=t.src,n=e.scale;this.scaled_x=this.x*n,this.scaled_y=this.y*n,this.scaled_width=this.width*n,this.scaled_height=this.height*n,this.scaled_moveX=this.moveX*n,this.scaled_moveY=this.moveY*n,i.save(),i.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&i.translate(-e.transX,-e.transY),this.sliceWidth&&this.sliceHeight?i.drawImage(e.loader.getImg(s),this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight,this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height):i.drawImage(e.loader.getImg(s),this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height),i.restore()},sliceWidth:t.sliceWidth,sliceHeight:t.sliceHeight,sliceX:t.sliceX,sliceY:t.sliceY})},line:function(t,e){return Object.assign({},T(t,e),{type:"line",draw:function(){var i=e.canvas,s=t.lineCap,n=t.lineJoin,a=t.smooth,o=this.lineWidth,r=e.scale;this.scaled_moveX=this.moveX*r,this.scaled_moveY=this.moveY*r,this.scaled_matrix=this.matrix.map(function(t){return t.map(function(t){return t*r})});var h=this.scaled_matrix;if(i.save(),i.translate(this.scaled_moveX,this.scaled_moveX),this.fixed&&i.translate(-e.transX,-e.transY),i.lineWidth=o,i.strokeStyle=this.color,i.beginPath(),i.lineDashOffset=this.offset,this.dash&&"[object Array]"===Object.prototype.toString.call(this.dash)&&i.setLineDash(this.dash),s&&(i.lineCap=s),n&&(i.lineJoin=n),a)for(var c=0;c<h.length;c++)if(0===c)i.moveTo(h[c][0],h[c][1]);else{var l=function(t,e,i,s){var n,a,o,r;if(i&&s||(i=.25,s=.25),e<1?(n=t[0][0]+(t[1][0]-t[0][0])*i,a=t[0][1]+(t[1][1]-t[0][1])*i):(n=t[e][0]+(t[e+1][0]-t[e-1][0])*i,a=t[e][1]+(t[e+1][1]-t[e-1][1])*i),e>t.length-3){var h=t.length-1;o=t[h][0]-(t[h][0]-t[h-1][0])*s,r=t[h][1]-(t[h][1]-t[h-1][1])*s}else o=t[e+1][0]-(t[e+2][0]-t[e][0])*s,r=t[e+1][1]-(t[e+2][1]-t[e][1])*s;return{pA:{x:n,y:a},pB:{x:o,y:r}}}(h,c-1);i.bezierCurveTo(l.pA.x,l.pA.y,l.pB.x,l.pB.y,h[c].x,h[c].y)}else h.forEach(function(t,e){0===e?i.moveTo(t[0],t[1]):i.lineTo(t[0],t[1])});i.stroke(),i.closePath(),i.restore()},totalLength:void 0,lineWidth:t.lineWidth||1,dash:t.dash,offset:t.offset||0,color:t.color||"#555",matrix:t.matrix,scaled_matrix:t.matrix})},rectangle:function(t,e){return Object.assign({},T(t,e),{type:"rectangle",draw:function(){var t=e.canvas,i=e.scale;this.scaled_x=this.x*i,this.scaled_y=this.y*i,this.scaled_width=this.width*i,this.scaled_height=this.height*i,this.scaled_moveX=this.moveX*i,this.scaled_moveY=this.moveY*i,t.save(),t.translate(this.scaled_x+this.scaled_width/2+this.scaled_moveX,this.scaled_y+this.scaled_height/2+this.scaled_moveY),t.rotate(Math.PI/180*this.rotate),t.translate(-(this.scaled_x+this.scaled_width/2+this.scaled_moveX),-(this.scaled_y+this.scaled_height/2+this.scaled_moveY)),t.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&t.translate(-e.transX,-e.transY),t.fillStyle=this.color?this.color:"#000",t.fillRect(this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height),t.restore()},rotate:t.rotate||0})},text:function(t,e){return Object.assign({},T(t,e),{type:"rectangle",draw:function(){var i=e.canvas,s=e.scale,n=t.center,a=t.fontFamily||"arial,sans-serif",o=(t.fontSize||14)*s+"px "+a;this.scaled_x=this.x*s,this.scaled_y=this.y*s,this.scaled_moveX=this.moveX*s,this.scaled_moveY=this.moveY*s,this.scaled_width=this.width*s,this.scaled_height=this.height*s,this.scaled_radius=this.radius*s,this.scaled_paddingTop=this.paddingTop*s;var r,h;i.save(),i.translate(this.scaled_moveX,this.scaled_moveY),this.fixed&&i.translate(-e.transX,-e.transY),this.backgroundColor&&(i.save(),i.fillStyle=this.backgroundColor,i.fillRect(this.scaled_x,this.scaled_y,this.scaled_width,this.scaled_height),i.restore()),i.font=o,i.textBaseline="top",r=i.measureText(this.text).width,h=function(t,e,i){var s=t.measureText(e).width,n=t.measureText("...").width;if(s<=i||s<=n)return e;for(var a=e.length;s>=i-n&&a-- >0;)e=e.substring(0,a),s=t.measureText(e).width;return e+"..."}(i,this.text,this.scaled_width-8),"stroke"===this.style?(i.strokeStyle=this.color,n?r<this.scaled_width-8&&i.strokeText(h,this.scaled_x+4+(this.scaled_width-r-8)/2,this.scaled_y+this.scaled_paddingTop):i.strokeText(h,this.scaled_x+4,this.scaled_y+this.scaled_paddingTop)):(i.fillStyle=this.color,n?r<this.scaled_width-8&&i.fillText(h,this.scaled_x+4+(this.scaled_width-r-8)/2,this.scaled_y+this.scaled_paddingTop):i.fillText(h,this.scaled_x+4,this.scaled_y+this.scaled_paddingTop)),i.restore()},color:t.color||"#fff",backgroundColor:t.backgroundColor,text:t.text||"no text",style:t.style||"fill",paddingTop:t.paddingTop||0,scaled_paddingTop:t.paddingTop?t.paddingTop*e.scale:0})},polygon:function(t,e){return Object.assign({},T(t,e),{type:"polygon",draw:function(){var t=e.canvas,i=e.scale;this.scaled_moveX=this.moveX*i,this.scaled_moveY=this.moveY*i,this.scaled_matrix=this.matrix.map(function(t){return t.map(function(t){return t*i})});var s=this.scaled_matrix;t.save(),t.translate(this.moveX,this.moveY),this.fixed&&t.translate(-e.transX,-e.transY),t.beginPath(),s.forEach(function(e,i){0===i?t.moveTo(e[0],e[1]):t.lineTo(e[0],e[1])}),t.lineTo(s[0][0],s[0][1]),"fill"===this.style?(t.fillStyle=this.color,t.fill()):(t.strokeStyle=this.color,t.lineWidth=this.lineWidth,t.stroke()),t.closePath(),t.restore()},style:t.style||"fill",color:t.color||"#555",lineWidth:t.lineWidth||1,matrix:t.matrix,scaled_matrix:t.matrix})}},j=function(s){var n=this;this.version="3.0.0-beta.3",this.objects=[],this.transX=0,this.transY=0,this.deviceScale=1,this.minDeviceScale=.5*this.deviceScale,this.maxDeviceScale=4*this.deviceScale,this.scale=this.deviceScale,this.loader=null,this.pointerInnerArray=[],this.globalMousedown=void 0,this.globalMousemove=void 0,this.isDragging=!1,this.Tween=x,this.animationList=[],this.animationId=null,this.animating=!1,this.fpsFunc=null,this.fps=0,this.fpsCacheTime=0,this.eventTypes=["mousedown","mouseup","mouseenter","mouseleave","mousemove","drag","dragend","dragin","dragout","drop"],this._event=new e(this),this.color=new i,this.element=s.element,this.canvas=this.element.getContext("2d"),this.width=s.width,this.height=s.height,function(t,e){var i=window.devicePixelRatio||1,s=null;t.forEach(function(t){s=t.getContext("2d"),t.style.width=e.width+"px",t.style.height=e.height+"px",t.width=e.width*i,t.height=e.height*i,s.scale(i,i)})}([this.element],{width:this.width,height:this.height}),this.enableGlobalTranslate=s.enableGlobalTranslate||!1,this.enableGlobalScale=s.enableGlobalScale||!1,this.images=s.images||[],this.utils=t,Object.keys(I).forEach(function(t){n[t]=function(e){return I[t](e,this)}})};j.prototype.imgReady=function(){this.loader=new s,this.loader.addImg(this.images)},j.prototype.addChild=function(e){t.isArr(e)?this.objects=this.objects.concat(e):this.objects.push(e),this.objects.sort(function(t,e){return t.zindex-e.zindex}),this._objects=t.reverse(this.objects)},j.prototype.removeChild=function(e){t.isArr(e)?this.objects=this.objects.filter(function(t){return!~e.indexOf(t)}):this.objects=this.objects.filter(function(t){return t!==e}),this._objects=t.reverse(this.objects)},j.prototype.removeFirstChild=function(){this.objects.pop(),this._objects=t.reverse(this.objects)},j.prototype.removeLastChild=function(){this.objects.shift(),this._objects=t.reverse(this.objects)},j.prototype.removeAllChilds=function(){this.objects=[],this._objects=[]},j.prototype.show=function(){var t=this;this.imgReady(),this.loader.ready(function(){t.draw(),t._event.triggerEvents()})},j.prototype.draw=function(){this.objects.forEach(function(t){t.draw()})},j.prototype.redraw=function(){this.clear(),this.canvas.save(),this.canvas.translate(this.transX,this.transY),this.draw(),this.canvas.restore()},j.prototype.clear=function(){this.canvas.clearRect(0,0,this.width,this.height)},j.prototype.tick=function(){var t=this,e=function(){if(t.fpsFunc){var i=Date.now();i-t.fpsCacheTime>=1e3?(t.fpsFunc(t.fps),t.fps=0,t.fpsCacheTime=i):t.fps++}t.animationList.forEach(function(e,i){e.finished?t.animationList.splice(i--,1):e.update?e.update():e()}),t.redraw(),t[t.animationId]=requestAnimationFrame(e)};return this.animationList.length>0&&!this.animating?(this.animating=!0,this.animationId=Date.now(),e()):0===this.animationList.length&&this.animating&&(this.animating=!1,cancelAnimationFrame(this.animationId)),this.animationId},j.prototype.fpsOn=function(t){this.fpsFunc=t,this.fpsCacheTime=Date.now()},j.prototype.fpsOff=function(){this.fpsFunc=null,this.fps=0},j.prototype.animate=function(t){this._event.triggerEvents();var e=Date.now();return this.animationList.push(t),this.tick(),e},j.prototype.stop=function(t){cancelAnimationFrame(this[t])},j.prototype.clearAnimation=function(){this.animationList=[],this.tick()},j.prototype.getVersion=function(){return this.version},j.prototype.mousedown=function(t){this.globalMousedown=t},j.prototype.mousemove=function(t){this.globalMousemove=t};return function(t){return new j(t)}});
